<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-name-shadowing #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lib</span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Lib.html"><span class="hs-identifier">Lib</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.State.Lazy</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Serialize</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Serialize</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Generic</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">{-
The python is bad but has the right idea.

We want DP to calculate the E and optimal choices at the same time.
DP is more than memoization, we want the table back.
-}</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- #hands: 21 * 20 / 2 = 210</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- #both hands: 210^2</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- #stand: 2 * 210^2</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- #bribe: 6 * 210^2</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- 264600</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- a linear solve will not agree</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">data</span><span> </span><span id="Action"><span class="annot"><a href="Lib.html#Action"><span class="hs-identifier hs-var">Action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NA"><span class="annot"><a href="Lib.html#NA"><span class="hs-identifier hs-var">NA</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Bet"><span class="annot"><a href="Lib.html#Bet"><span class="hs-identifier hs-var">Bet</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Hit"><span class="annot"><a href="Lib.html#Hit"><span class="hs-identifier hs-var">Hit</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Stand"><span class="annot"><a href="Lib.html#Stand"><span class="hs-identifier hs-var">Stand</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Bribe"><span class="annot"><a href="Lib.html#Bribe"><span class="hs-identifier hs-var">Bribe</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679072366"><span id="local-6989586621679072370"><span class="annot"><span class="annottext">Action -&gt; Action -&gt; Bool
(Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool) -&gt; Eq Action
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Action -&gt; Action -&gt; Bool
== :: Action -&gt; Action -&gt; Bool
$c/= :: Action -&gt; Action -&gt; Bool
/= :: Action -&gt; Action -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072377"><span id="local-6989586621679072381"><span id="local-6989586621679072385"><span id="local-6989586621679072388"><span id="local-6989586621679072391"><span id="local-6989586621679072394"><span id="local-6989586621679072397"><span class="annot"><span class="annottext">Eq Action
Eq Action =&gt;
(Action -&gt; Action -&gt; Ordering)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Action)
-&gt; (Action -&gt; Action -&gt; Action)
-&gt; Ord Action
Action -&gt; Action -&gt; Bool
Action -&gt; Action -&gt; Ordering
Action -&gt; Action -&gt; Action
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Action -&gt; Action -&gt; Ordering
compare :: Action -&gt; Action -&gt; Ordering
$c&lt; :: Action -&gt; Action -&gt; Bool
&lt; :: Action -&gt; Action -&gt; Bool
$c&lt;= :: Action -&gt; Action -&gt; Bool
&lt;= :: Action -&gt; Action -&gt; Bool
$c&gt; :: Action -&gt; Action -&gt; Bool
&gt; :: Action -&gt; Action -&gt; Bool
$c&gt;= :: Action -&gt; Action -&gt; Bool
&gt;= :: Action -&gt; Action -&gt; Bool
$cmax :: Action -&gt; Action -&gt; Action
max :: Action -&gt; Action -&gt; Action
$cmin :: Action -&gt; Action -&gt; Action
min :: Action -&gt; Action -&gt; Action
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072401"><span id="local-6989586621679072406"><span id="local-6989586621679072410"><span class="annot"><span class="annottext">Int -&gt; Action -&gt; ShowS
[Action] -&gt; ShowS
Action -&gt; String
(Int -&gt; Action -&gt; ShowS)
-&gt; (Action -&gt; String) -&gt; ([Action] -&gt; ShowS) -&gt; Show Action
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Action -&gt; ShowS
showsPrec :: Int -&gt; Action -&gt; ShowS
$cshow :: Action -&gt; String
show :: Action -&gt; String
$cshowList :: [Action] -&gt; ShowS
showList :: [Action] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072414"><span id="local-6989586621679072416"><span class="annot"><span class="annottext">(forall x. Action -&gt; Rep Action x)
-&gt; (forall x. Rep Action x -&gt; Action) -&gt; Generic Action
forall x. Rep Action x -&gt; Action
forall x. Action -&gt; Rep Action x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Action -&gt; Rep Action x
from :: forall x. Action -&gt; Rep Action x
$cto :: forall x. Rep Action x -&gt; Action
to :: forall x. Rep Action x -&gt; Action
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">data</span><span> </span><span id="Stats"><span class="annot"><a href="Lib.html#Stats"><span class="hs-identifier hs-var">Stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stats"><span class="annot"><a href="Lib.html#Stats"><span class="hs-identifier hs-var">Stats</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="action"><span class="annot"><span class="annottext">Stats -&gt; Action
</span><a href="Lib.html#action"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span id="expectation"><span class="annot"><span class="annottext">Stats -&gt; Double
</span><a href="Lib.html#expectation"><span class="hs-identifier hs-var hs-var">expectation</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679072423"><span id="local-6989586621679072428"><span class="annot"><span class="annottext">Stats -&gt; Stats -&gt; Bool
(Stats -&gt; Stats -&gt; Bool) -&gt; (Stats -&gt; Stats -&gt; Bool) -&gt; Eq Stats
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Stats -&gt; Stats -&gt; Bool
== :: Stats -&gt; Stats -&gt; Bool
$c/= :: Stats -&gt; Stats -&gt; Bool
/= :: Stats -&gt; Stats -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072434"><span id="local-6989586621679072439"><span id="local-6989586621679072443"><span id="local-6989586621679072447"><span id="local-6989586621679072450"><span id="local-6989586621679072453"><span id="local-6989586621679072456"><span class="annot"><span class="annottext">Eq Stats
Eq Stats =&gt;
(Stats -&gt; Stats -&gt; Ordering)
-&gt; (Stats -&gt; Stats -&gt; Bool)
-&gt; (Stats -&gt; Stats -&gt; Bool)
-&gt; (Stats -&gt; Stats -&gt; Bool)
-&gt; (Stats -&gt; Stats -&gt; Bool)
-&gt; (Stats -&gt; Stats -&gt; Stats)
-&gt; (Stats -&gt; Stats -&gt; Stats)
-&gt; Ord Stats
Stats -&gt; Stats -&gt; Bool
Stats -&gt; Stats -&gt; Ordering
Stats -&gt; Stats -&gt; Stats
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Stats -&gt; Stats -&gt; Ordering
compare :: Stats -&gt; Stats -&gt; Ordering
$c&lt; :: Stats -&gt; Stats -&gt; Bool
&lt; :: Stats -&gt; Stats -&gt; Bool
$c&lt;= :: Stats -&gt; Stats -&gt; Bool
&lt;= :: Stats -&gt; Stats -&gt; Bool
$c&gt; :: Stats -&gt; Stats -&gt; Bool
&gt; :: Stats -&gt; Stats -&gt; Bool
$c&gt;= :: Stats -&gt; Stats -&gt; Bool
&gt;= :: Stats -&gt; Stats -&gt; Bool
$cmax :: Stats -&gt; Stats -&gt; Stats
max :: Stats -&gt; Stats -&gt; Stats
$cmin :: Stats -&gt; Stats -&gt; Stats
min :: Stats -&gt; Stats -&gt; Stats
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072459"><span id="local-6989586621679072465"><span id="local-6989586621679072469"><span class="annot"><span class="annottext">Int -&gt; Stats -&gt; ShowS
[Stats] -&gt; ShowS
Stats -&gt; String
(Int -&gt; Stats -&gt; ShowS)
-&gt; (Stats -&gt; String) -&gt; ([Stats] -&gt; ShowS) -&gt; Show Stats
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Stats -&gt; ShowS
showsPrec :: Int -&gt; Stats -&gt; ShowS
$cshow :: Stats -&gt; String
show :: Stats -&gt; String
$cshowList :: [Stats] -&gt; ShowS
showList :: [Stats] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072472"><span id="local-6989586621679072474"><span class="annot"><span class="annottext">(forall x. Stats -&gt; Rep Stats x)
-&gt; (forall x. Rep Stats x -&gt; Stats) -&gt; Generic Stats
forall x. Rep Stats x -&gt; Stats
forall x. Stats -&gt; Rep Stats x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Stats -&gt; Rep Stats x
from :: forall x. Stats -&gt; Rep Stats x
$cto :: forall x. Rep Stats x -&gt; Stats
to :: forall x. Rep Stats x -&gt; Stats
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">data</span><span> </span><span id="Status"><span class="annot"><a href="Lib.html#Status"><span class="hs-identifier hs-var">Status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Play"><span class="annot"><a href="Lib.html#Play"><span class="hs-identifier hs-var">Play</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Win"><span class="annot"><a href="Lib.html#Win"><span class="hs-identifier hs-var">Win</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Lose"><span class="annot"><a href="Lib.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Draw"><span class="annot"><a href="Lib.html#Draw"><span class="hs-identifier hs-var">Draw</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679072481"><span id="local-6989586621679072483"><span class="annot"><span class="annottext">Status -&gt; Status -&gt; Bool
(Status -&gt; Status -&gt; Bool)
-&gt; (Status -&gt; Status -&gt; Bool) -&gt; Eq Status
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Status -&gt; Status -&gt; Bool
== :: Status -&gt; Status -&gt; Bool
$c/= :: Status -&gt; Status -&gt; Bool
/= :: Status -&gt; Status -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072489"><span id="local-6989586621679072491"><span id="local-6989586621679072493"><span id="local-6989586621679072497"><span id="local-6989586621679072500"><span id="local-6989586621679072503"><span id="local-6989586621679072506"><span class="annot"><span class="annottext">Eq Status
Eq Status =&gt;
(Status -&gt; Status -&gt; Ordering)
-&gt; (Status -&gt; Status -&gt; Bool)
-&gt; (Status -&gt; Status -&gt; Bool)
-&gt; (Status -&gt; Status -&gt; Bool)
-&gt; (Status -&gt; Status -&gt; Bool)
-&gt; (Status -&gt; Status -&gt; Status)
-&gt; (Status -&gt; Status -&gt; Status)
-&gt; Ord Status
Status -&gt; Status -&gt; Bool
Status -&gt; Status -&gt; Ordering
Status -&gt; Status -&gt; Status
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Status -&gt; Status -&gt; Ordering
compare :: Status -&gt; Status -&gt; Ordering
$c&lt; :: Status -&gt; Status -&gt; Bool
&lt; :: Status -&gt; Status -&gt; Bool
$c&lt;= :: Status -&gt; Status -&gt; Bool
&lt;= :: Status -&gt; Status -&gt; Bool
$c&gt; :: Status -&gt; Status -&gt; Bool
&gt; :: Status -&gt; Status -&gt; Bool
$c&gt;= :: Status -&gt; Status -&gt; Bool
&gt;= :: Status -&gt; Status -&gt; Bool
$cmax :: Status -&gt; Status -&gt; Status
max :: Status -&gt; Status -&gt; Status
$cmin :: Status -&gt; Status -&gt; Status
min :: Status -&gt; Status -&gt; Status
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072509"><span id="local-6989586621679072511"><span id="local-6989586621679072515"><span class="annot"><span class="annottext">Int -&gt; Status -&gt; ShowS
[Status] -&gt; ShowS
Status -&gt; String
(Int -&gt; Status -&gt; ShowS)
-&gt; (Status -&gt; String) -&gt; ([Status] -&gt; ShowS) -&gt; Show Status
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Status -&gt; ShowS
showsPrec :: Int -&gt; Status -&gt; ShowS
$cshow :: Status -&gt; String
show :: Status -&gt; String
$cshowList :: [Status] -&gt; ShowS
showList :: [Status] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">data</span><span> </span><span id="Hand"><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Hand"><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="normals"><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Lib.html#normals"><span class="hs-identifier hs-var hs-var">normals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="ace"><span class="annot"><span class="annottext">Hand -&gt; Bool
</span><a href="Lib.html#ace"><span class="hs-identifier hs-var hs-var">ace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679072521"><span id="local-6989586621679072525"><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Bool
(Hand -&gt; Hand -&gt; Bool) -&gt; (Hand -&gt; Hand -&gt; Bool) -&gt; Eq Hand
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Hand -&gt; Hand -&gt; Bool
== :: Hand -&gt; Hand -&gt; Bool
$c/= :: Hand -&gt; Hand -&gt; Bool
/= :: Hand -&gt; Hand -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072531"><span id="local-6989586621679072535"><span id="local-6989586621679072539"><span id="local-6989586621679072543"><span id="local-6989586621679072546"><span id="local-6989586621679072549"><span id="local-6989586621679072552"><span class="annot"><span class="annottext">Eq Hand
Eq Hand =&gt;
(Hand -&gt; Hand -&gt; Ordering)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Hand)
-&gt; (Hand -&gt; Hand -&gt; Hand)
-&gt; Ord Hand
Hand -&gt; Hand -&gt; Bool
Hand -&gt; Hand -&gt; Ordering
Hand -&gt; Hand -&gt; Hand
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Hand -&gt; Hand -&gt; Ordering
compare :: Hand -&gt; Hand -&gt; Ordering
$c&lt; :: Hand -&gt; Hand -&gt; Bool
&lt; :: Hand -&gt; Hand -&gt; Bool
$c&lt;= :: Hand -&gt; Hand -&gt; Bool
&lt;= :: Hand -&gt; Hand -&gt; Bool
$c&gt; :: Hand -&gt; Hand -&gt; Bool
&gt; :: Hand -&gt; Hand -&gt; Bool
$c&gt;= :: Hand -&gt; Hand -&gt; Bool
&gt;= :: Hand -&gt; Hand -&gt; Bool
$cmax :: Hand -&gt; Hand -&gt; Hand
max :: Hand -&gt; Hand -&gt; Hand
$cmin :: Hand -&gt; Hand -&gt; Hand
min :: Hand -&gt; Hand -&gt; Hand
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072555"><span id="local-6989586621679072561"><span id="local-6989586621679072565"><span class="annot"><span class="annottext">Int -&gt; Hand -&gt; ShowS
[Hand] -&gt; ShowS
Hand -&gt; String
(Int -&gt; Hand -&gt; ShowS)
-&gt; (Hand -&gt; String) -&gt; ([Hand] -&gt; ShowS) -&gt; Show Hand
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Hand -&gt; ShowS
showsPrec :: Int -&gt; Hand -&gt; ShowS
$cshow :: Hand -&gt; String
show :: Hand -&gt; String
$cshowList :: [Hand] -&gt; ShowS
showList :: [Hand] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072568"><span id="local-6989586621679072570"><span class="annot"><span class="annottext">(forall x. Hand -&gt; Rep Hand x)
-&gt; (forall x. Rep Hand x -&gt; Hand) -&gt; Generic Hand
forall x. Rep Hand x -&gt; Hand
forall x. Hand -&gt; Rep Hand x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Hand -&gt; Rep Hand x
from :: forall x. Hand -&gt; Rep Hand x
$cto :: forall x. Rep Hand x -&gt; Hand
to :: forall x. Rep Hand x -&gt; Hand
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">data</span><span> </span><span id="Blackjack"><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-var">Blackjack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Blackjack"><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-var">Blackjack</span></a></span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="you"><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Lib.html#you"><span class="hs-identifier hs-var hs-var">you</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span id="dealer"><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Lib.html#dealer"><span class="hs-identifier hs-var hs-var">dealer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span id="stand"><span class="annot"><span class="annottext">Blackjack -&gt; Bool
</span><a href="Lib.html#stand"><span class="hs-identifier hs-var hs-var">stand</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="bribeM_"><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Lib.html#bribeM_"><span class="hs-identifier hs-var hs-var">bribeM_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bribe"><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Lib.html#bribe"><span class="hs-identifier hs-var hs-var">bribe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="multiplier_"><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Lib.html#multiplier_"><span class="hs-identifier hs-var hs-var">multiplier_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="bet"><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Lib.html#bet"><span class="hs-identifier hs-var hs-var">bet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679072581"><span id="local-6989586621679072590"><span class="annot"><span class="annottext">Blackjack -&gt; Blackjack -&gt; Bool
(Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool) -&gt; Eq Blackjack
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Blackjack -&gt; Blackjack -&gt; Bool
== :: Blackjack -&gt; Blackjack -&gt; Bool
$c/= :: Blackjack -&gt; Blackjack -&gt; Bool
/= :: Blackjack -&gt; Blackjack -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072596"><span id="local-6989586621679072605"><span id="local-6989586621679072614"><span id="local-6989586621679072617"><span id="local-6989586621679072620"><span id="local-6989586621679072623"><span id="local-6989586621679072626"><span class="annot"><span class="annottext">Eq Blackjack
Eq Blackjack =&gt;
(Blackjack -&gt; Blackjack -&gt; Ordering)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Blackjack)
-&gt; (Blackjack -&gt; Blackjack -&gt; Blackjack)
-&gt; Ord Blackjack
Blackjack -&gt; Blackjack -&gt; Bool
Blackjack -&gt; Blackjack -&gt; Ordering
Blackjack -&gt; Blackjack -&gt; Blackjack
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Blackjack -&gt; Blackjack -&gt; Ordering
compare :: Blackjack -&gt; Blackjack -&gt; Ordering
$c&lt; :: Blackjack -&gt; Blackjack -&gt; Bool
&lt; :: Blackjack -&gt; Blackjack -&gt; Bool
$c&lt;= :: Blackjack -&gt; Blackjack -&gt; Bool
&lt;= :: Blackjack -&gt; Blackjack -&gt; Bool
$c&gt; :: Blackjack -&gt; Blackjack -&gt; Bool
&gt; :: Blackjack -&gt; Blackjack -&gt; Bool
$c&gt;= :: Blackjack -&gt; Blackjack -&gt; Bool
&gt;= :: Blackjack -&gt; Blackjack -&gt; Bool
$cmax :: Blackjack -&gt; Blackjack -&gt; Blackjack
max :: Blackjack -&gt; Blackjack -&gt; Blackjack
$cmin :: Blackjack -&gt; Blackjack -&gt; Blackjack
min :: Blackjack -&gt; Blackjack -&gt; Blackjack
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072629"><span id="local-6989586621679072639"><span id="local-6989586621679072643"><span class="annot"><span class="annottext">Int -&gt; Blackjack -&gt; ShowS
[Blackjack] -&gt; ShowS
Blackjack -&gt; String
(Int -&gt; Blackjack -&gt; ShowS)
-&gt; (Blackjack -&gt; String)
-&gt; ([Blackjack] -&gt; ShowS)
-&gt; Show Blackjack
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Blackjack -&gt; ShowS
showsPrec :: Int -&gt; Blackjack -&gt; ShowS
$cshow :: Blackjack -&gt; String
show :: Blackjack -&gt; String
$cshowList :: [Blackjack] -&gt; ShowS
showList :: [Blackjack] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072646"><span id="local-6989586621679072648"><span class="annot"><span class="annottext">(forall x. Blackjack -&gt; Rep Blackjack x)
-&gt; (forall x. Rep Blackjack x -&gt; Blackjack) -&gt; Generic Blackjack
forall x. Rep Blackjack x -&gt; Blackjack
forall x. Blackjack -&gt; Rep Blackjack x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Blackjack -&gt; Rep Blackjack x
from :: forall x. Blackjack -&gt; Rep Blackjack x
$cto :: forall x. Rep Blackjack x -&gt; Blackjack
to :: forall x. Rep Blackjack x -&gt; Blackjack
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span id="local-6989586621679072651"><span id="local-6989586621679072658"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span></span></span><span>
</span><span id="line-39"></span><span id="local-6989586621679072689"><span id="local-6989586621679072696"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span></span></span><span>
</span><span id="line-40"></span><span id="local-6989586621679072747"><span id="local-6989586621679072754"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="Lib.html#Action"><span class="hs-identifier hs-type">Action</span></a></span></span></span><span>
</span><span id="line-41"></span><span id="local-6989586621679072812"><span id="local-6989586621679072819"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="Lib.html#Stats"><span class="hs-identifier hs-type">Stats</span></a></span></span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">type</span><span> </span><span id="DP"><span class="annot"><a href="Lib.html#DP"><span class="hs-identifier hs-var">DP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="annot"><a href="Lib.html#Stats"><span class="hs-identifier hs-type">Stats</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="annot"><a href="Lib.html#blackjack0"><span class="hs-identifier hs-type">blackjack0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span>
</span><span id="line-46"></span><span id="blackjack0"><span class="annot"><span class="annottext">blackjack0 :: Blackjack
</span><a href="Lib.html#blackjack0"><span class="hs-identifier hs-var hs-var">blackjack0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Bool -&gt; Int -&gt; Int -&gt; Int -&gt; Double -&gt; Blackjack
</span><a href="Lib.html#Blackjack"><span class="hs-identifier hs-var">Blackjack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- use Control.Monad.Memo</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="annot"><a href="Lib.html#memoOld"><span class="hs-identifier hs-type">memoOld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Lib.html#DP"><span class="hs-identifier hs-type">DP</span></a></span><span> </span><span class="annot"><a href="Lib.html#Stats"><span class="hs-identifier hs-type">Stats</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Lib.html#DP"><span class="hs-identifier hs-type">DP</span></a></span><span> </span><span class="annot"><a href="Lib.html#Stats"><span class="hs-identifier hs-type">Stats</span></a></span><span>
</span><span id="line-51"></span><span id="memoOld"><span class="annot"><span class="annottext">memoOld :: (Blackjack -&gt; State DP Stats) -&gt; Blackjack -&gt; State DP Stats
</span><a href="Lib.html#memoOld"><span class="hs-identifier hs-var hs-var">memoOld</span></a></span></span><span> </span><span id="local-6989586621679072842"><span class="annot"><span class="annottext">Blackjack -&gt; State DP Stats
</span><a href="#local-6989586621679072842"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679072843"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072843"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-52"></span><span>    </span><span id="local-6989586621679072844"><span class="annot"><span class="annottext">DP
</span><a href="#local-6989586621679072844"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT DP Identity DP
forall (m :: * -&gt; *) s. Monad m =&gt; StateT s m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DP
</span><a href="#local-6989586621679072844"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">DP -&gt; Blackjack -&gt; Maybe Stats
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072843"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679072846"><span class="annot"><span class="annottext">Stats
</span><a href="#local-6989586621679072846"><span class="hs-identifier hs-var">v</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stats -&gt; State DP Stats
forall a. a -&gt; StateT DP Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Stats
</span><a href="#local-6989586621679072846"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><span class="annottext">Maybe Stats
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-56"></span><span>            </span><span id="local-6989586621679072847"><span class="annot"><span class="annottext">Stats
</span><a href="#local-6989586621679072847"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; State DP Stats
</span><a href="#local-6989586621679072842"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072843"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-57"></span><span>            </span><span class="annot"><span class="annottext">(DP -&gt; DP) -&gt; StateT DP Identity ()
forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; s) -&gt; StateT s m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((DP -&gt; DP) -&gt; StateT DP Identity ())
-&gt; (DP -&gt; DP) -&gt; StateT DP Identity ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Stats -&gt; DP -&gt; DP
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072843"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Stats
</span><a href="#local-6989586621679072847"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-58"></span><span>            </span><span class="annot"><span class="annottext">Stats -&gt; State DP Stats
forall a. a -&gt; StateT DP Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Stats
</span><a href="#local-6989586621679072847"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span id="local-6989586621679072270"><span id="local-6989586621679072271"><span id="local-6989586621679072272"><span class="annot"><a href="Lib.html#ldist"><span class="hs-identifier hs-type">ldist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679072270"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072270"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679072271"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072272"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072270"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072271"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072272"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-61"></span><span id="ldist"><span class="annot"><span class="annottext">ldist :: forall (f :: * -&gt; *) a t. Functor f =&gt; (f a, t) -&gt; f (a, t)
</span><a href="Lib.html#ldist"><span class="hs-identifier hs-var hs-var">ldist</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679072852"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679072852"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679072853"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679072853"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679072853"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, t)) -&gt; f a -&gt; f (a, t)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621679072852"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="annot"><a href="Lib.html#multiplier"><span class="hs-identifier hs-type">multiplier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-64"></span><span id="multiplier"><span class="annot"><span class="annottext">multiplier :: Blackjack -&gt; Double
</span><a href="Lib.html#multiplier"><span class="hs-identifier hs-var hs-var">multiplier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; (Blackjack -&gt; Double) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; (Blackjack -&gt; Double) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Blackjack -&gt; Int) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Lib.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><a href="Lib.html#bribeM"><span class="hs-identifier hs-type">bribeM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-67"></span><span id="bribeM"><span class="annot"><span class="annottext">bribeM :: Blackjack -&gt; Double
</span><a href="Lib.html#bribeM"><span class="hs-identifier hs-var hs-var">bribeM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.75</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Blackjack -&gt; Int) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Lib.html#bribeM_"><span class="hs-identifier hs-var">bribeM_</span></a></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">{-
dp' :: Blackjack -&gt; State DP Stats
dp' b = let dpM = memoOld dp' in do
    -- we cut off the table at 5.1 thank you
    -- just look at the bit between 2.0 and 4.0
    -- alternative is matrix but the system is too big

    -- _ &lt;- traceShow b (return ())
    if multiplier_ b &gt; 30 {-5.0-} then
        return $ Stats Stand 0
    else
        case blackjackState b of
            Win -&gt; do
                let e = if bet b then multiplier b * bribeM b - 1 else 0
                e' &lt;- dpM (blackjack0 { multiplier_ = multiplier_ b + 1 })
                return $ Stats NA (e + expectation e')
            Draw -&gt; do
                -- should be the solution of some system but table too big 
                e' &lt;- dpM (blackjack0 { multiplier_ = multiplier_ b + 1 })
                return $ Stats NA $ expectation e' + if bet b then bribeM b - 1 else 0
            Lose -&gt; do
                return $ Stats NA $ if bet b then (-1) else 0
            Play -&gt; do
                if you b == mempty then do
                    {- essNoBet &lt;- forM (liftA2 (&lt;&gt;) draw draw) $ \ drawYou -&gt;
                           forM (liftA2 (&lt;&gt;) draw draw) $ \ drawDealer -&gt;
                           dpM (b { you = drawYou , dealer = drawDealer , bet = False })
                    let eNoBet = average $ expectation &lt;$&gt; concat essNoBet -}
                    -- for current params, bet is always True
                    essBet &lt;- forM (liftA2 (&lt;&gt;) draw draw) $ \ drawYou -&gt;
                           forM (liftA2 (&lt;&gt;) draw draw) $ \ drawDealer -&gt;
                           dpM (b { you = drawYou , dealer = drawDealer , bet = True })
                    let eBet = average $ expectation &lt;$&gt; concat essBet
                    return $ Stats (Bet True) eBet
                    {- if eBet &gt; eNoBet then
                        return $ Stats (Bet True) eBet
                    else
                        return $ Stats (Bet False) eNoBet -}
                else if stand b then do
                    esHit &lt;- forM draw $ \ drawDealer -&gt;
                                 dpM (b { dealer = dealer b &lt;&gt; drawDealer })
                    return $ Stats NA $ average $ expectation &lt;$&gt; esHit
                else do
                    let bribe' = max 0 (bribe b - 1)
                    let pBribe = fromIntegral (bribe b) / 4

                    eHitBribe &lt;- expectation &lt;$&gt; if valueHand (you b) &gt; 10
                        then dpM (b { you = Hand 21 False })
                        else dpM (b { you = you b &lt;&gt; normalHand 10 , bribe = bribe' })

                    esHit &lt;- forM draw $ \ drawYou -&gt;
                                 dpM (b { you = you b &lt;&gt; drawYou , bribe = bribe' })

                    let eHitFair = average $ expectation &lt;$&gt; esHit
                    let eHit = pBribe * eHitBribe + (1 - pBribe) * eHitFair

                    -- setting bribe = 0 makes the table marginally smaller
                    eStand &lt;- expectation &lt;$&gt; dpM (b { stand = True , bribe = 0 })
                    eBribe &lt;- do
                        if bribeM_ b &gt; 2 then
                            return $ -2
                        else
                            expectation &lt;$&gt; dpM (b { bribe = 1 + bribe b , bribeM_ = 1 + bribeM_ b })

                    let s = sortOn (negate . expectation)
                         [Stats Hit eHit, Stats Stand eStand, Stats Bribe eBribe]

                    return $ head s

dp :: DP
dp = execState (memoOld dp' blackjack0) mempty
-- this doesn't understand stability, I think

computeAndStore :: IO ()
computeAndStore = do
    _ &lt;- BS.writeFile &quot;holocure_blackjack_0bet.bin&quot; $ encode dp
    return ()

dpf_ :: IO DP
dpf_ = fromRight (error &quot;bad read: dpFromFile&quot;) . decode &lt;$&gt; BS.readFile &quot;holocure_blackjack_0bet.bin&quot;

dpf :: IO DP
dpf = M.filterWithKey f &lt;$&gt; dpf_
    where
    f b s = action s /= NA &amp;&amp; multiplier_ b &lt; 20

poll :: DP -&gt; (Int, Int) -&gt; (Int, Int) -&gt; Int -&gt; Int -&gt; Int -&gt; Stats
poll dp (y, ya) (d, da) m b mb = dp M.! blackjack0 { you = Hand y (ya &gt; 0) , dealer = Hand d (da &gt; 0) , multiplier_ = m , bribe = b , bribeM_ = mb }

dpf' :: IO (M.Map (Hand, Hand, Int, Int) [(Blackjack, Stats)])
dpf' = M.mapKeysWith (++) (\ b -&gt; (you b , dealer b , bribe b , bribeM_ b)) . fmap (:[]) . graph &lt;$&gt; dpf

crude :: IO (M.Map (Hand, Hand, Int, Int) [(Int, Action)])
crude = fmap (fmap go) dpf'
    where
    go :: [(Blackjack, Stats)] -&gt; [(Int, Action)]
    go = fmap pick . groupBy ((==) `on` action . snd) . sortOn fst . fmap (first multiplier_)

    pick :: [(Int, Stats)] -&gt; (Int, Action)
    pick xs@(x : _) = (minimum (fst &lt;$&gt; xs), action $ snd x)
    pick [] = error &quot;crude:pick: This is bad.&quot;

cf :: IO (M.Map (Hand, Hand, Int, Int) [(Int, Action)])
cf = fromRight (error &quot;bad read: cf&quot;) . decode &lt;$&gt; BS.readFile &quot;holocure_blackjack_crude_expect.bin&quot;
-}</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- TODO have fun chiseling at cf</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- 1.</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- poll dpf (20, 0) (20, 0) 10 3 3</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- is a Hit but it should be Stand? (is this because draw is completely wrong? lol)</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- maybe just use a rescaled E from a higher multiplier</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- 2. </span><span>
</span><span id="line-184"></span><span class="hs-comment">-- we maximize the E of one run</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- this is bad</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- you want to maximize: the expected geometric growth rate</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- a. r = r_a^p_a * ...</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- b. kelly f^* = \mu / V for mean \mu and variance V</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- but r_a depends on f^*...</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- solution: just run it at 0.0, 0.05, 0.1 and see what happens</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">-- 4. TODO</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- does the capped kelly bet really tend to the expectation bet for bank &gt;&gt; cap?</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- TODO remove bet :: Bool because it is constantly True</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- nub $ concat $ catMaybes $ [cf' M.!? (Hand x False, Hand y False, 0, 0) | x &lt;- [1..11], y &lt;- [0..21]]</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679072863"><span id="local-6989586621679072867"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679072876"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072876"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679072877"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072877"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679072878"><span class="annot"><span class="annottext">&lt;&gt; :: Hand -&gt; Hand -&gt; Hand
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679072879"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072879"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span id="local-6989586621679072880"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072880"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072877"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072880"><span class="hs-identifier hs-var">w</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072876"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072879"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-203"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072876"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072879"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072877"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072880"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679072887"><span id="local-6989586621679072891"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679072894"><span class="annot"><span class="annottext">mempty :: Hand
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621679072291"><span class="annot"><a href="Lib.html#average"><span class="hs-identifier hs-type">average</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679072291"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679072291"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072291"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-210"></span><span id="average"><span class="annot"><span class="annottext">average :: forall a. Fractional a =&gt; [a] -&gt; a
</span><a href="Lib.html#average"><span class="hs-identifier hs-var hs-var">average</span></a></span></span><span> </span><span id="local-6989586621679072906"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679072906"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679072906"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679072906"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="annot"><a href="Lib.html#draw"><span class="hs-identifier hs-type">draw</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span id="draw"><span class="annot"><span class="annottext">draw :: [Hand]
</span><a href="Lib.html#draw"><span class="hs-identifier hs-var hs-var">draw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Hand -&gt; [Hand] -&gt; [Hand]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Hand
</span><a href="Lib.html#normalHand"><span class="hs-identifier hs-var">normalHand</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Hand) -&gt; [Int] -&gt; [Hand]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Lib.html#normalHand"><span class="hs-identifier hs-type">normalHand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span>
</span><span id="line-216"></span><span id="normalHand"><span class="annot"><span class="annottext">normalHand :: Int -&gt; Hand
</span><a href="Lib.html#normalHand"><span class="hs-identifier hs-var hs-var">normalHand</span></a></span></span><span> </span><span id="local-6989586621679072912"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072912"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Lib.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072912"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><a href="Lib.html#draws"><span class="hs-identifier hs-type">draws</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-219"></span><span id="draws"><span class="annot"><span class="annottext">draws :: Int
</span><a href="Lib.html#draws"><span class="hs-identifier hs-var hs-var">draws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><a href="Lib.html#blackjackState"><span class="hs-identifier hs-type">blackjackState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lib.html#Status"><span class="hs-identifier hs-type">Status</span></a></span><span>
</span><span id="line-222"></span><span id="blackjackState"><span class="annot"><span class="annottext">blackjackState :: Blackjack -&gt; Status
</span><a href="Lib.html#blackjackState"><span class="hs-identifier hs-var hs-var">blackjackState</span></a></span></span><span> </span><span id="local-6989586621679072915"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072915"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072916"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072918"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Win"><span class="hs-identifier hs-var">Win</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072918"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072916"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Draw"><span class="hs-identifier hs-var">Draw</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072916"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Win"><span class="hs-identifier hs-var">Win</span></a></span><span> </span><span class="hs-comment">-- the order of the clauses matters now</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Bool
</span><a href="Lib.html#stand"><span class="hs-identifier hs-var">stand</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072915"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072916"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072918"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-228"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072918"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">17</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Play"><span class="hs-identifier hs-var">Play</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-229"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072916"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072918"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Draw"><span class="hs-identifier hs-var">Draw</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Win"><span class="hs-identifier hs-var">Win</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="Lib.html#Play"><span class="hs-identifier hs-var">Play</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-232"></span><span>  </span><span id="local-6989586621679072916"><span class="annot"><span class="annottext">y :: Int
</span><a href="#local-6989586621679072916"><span class="hs-identifier hs-var hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Lib.html#valueHand"><span class="hs-identifier hs-var">valueHand</span></a></span><span> </span><span class="annot"><span class="annottext">(Hand -&gt; Int) -&gt; Hand -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Lib.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072915"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621679072918"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621679072918"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Lib.html#valueHand"><span class="hs-identifier hs-var">valueHand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Lib.html#dealer"><span class="hs-identifier hs-var">dealer</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679072915"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="Lib.html#valueHand"><span class="hs-identifier hs-type">valueHand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-236"></span><span id="valueHand"><span class="annot"><span class="annottext">valueHand :: Hand -&gt; Int
</span><a href="Lib.html#valueHand"><span class="hs-identifier hs-var hs-var">valueHand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lib.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679072921"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072921"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679072922"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072922"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072922"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072921"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072921"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679072922"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072921"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679072921"><span class="hs-identifier hs-var">n</span></a></span></pre></body></html>