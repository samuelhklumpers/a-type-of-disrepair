<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="annot"><span class="hs-comment">{-|
This module defines a variant of Blackjack and formulates the optimal strategy as a `DPProblem`.
-}</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Blackjack</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Blackjack.html#computeAndStore"><span class="hs-identifier">computeAndStore</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#dumpCSV%27"><span class="hs-identifier">dumpCSV'</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">shiftL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.|.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">xor</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromRight</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Function</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">on</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Hashable</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hash</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">groupBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Serialize</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">encode</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Serialize</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">decode</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Traversable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromString</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Float</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">castDoubleToWord64</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="DP.html"><span class="hs-identifier">DP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DP.html#DPProblem"><span class="hs-identifier">DPProblem</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DP.html#enumSearch"><span class="hs-identifier">enumSearch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DP.html#uniSearch"><span class="hs-identifier">uniSearch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DP.html#reducedDP"><span class="hs-identifier">reducedDP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Probability.html"><span class="hs-identifier">Probability</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Probability.html#Mean"><span class="hs-identifier">Mean</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#MaxMean"><span class="hs-identifier">MaxMean</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#weightedAvg"><span class="hs-identifier">weightedAvg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#avg"><span class="hs-identifier">avg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#Mixture"><span class="hs-identifier">Mixture</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#mean"><span class="hs-identifier">mean</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#Log1P"><span class="hs-identifier">Log1P</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#HasMean"><span class="hs-identifier">HasMean</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><span class="hs-comment">{-| 
The type of blackjack states.
-}</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">data</span><span> </span><span id="Blackjack"><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-var">Blackjack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Blackjack"><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-var">Blackjack</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The player's hand.</span></span><span>
</span><span id="line-42"></span><span>    </span><span id="you"><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#you"><span class="hs-identifier hs-var hs-var">you</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The dealers's hand.</span></span><span>
</span><span id="line-44"></span><span>    </span><span id="dealer"><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#dealer"><span class="hs-identifier hs-var hs-var">dealer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-comment">-- | `True` if the player is standing.</span></span><span>
</span><span id="line-46"></span><span>    </span><span id="stand"><span class="annot"><span class="annottext">Blackjack -&gt; Bool
</span><a href="Blackjack.html#stand"><span class="hs-identifier hs-var hs-var">stand</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The penalty counter for bribing, the actual penalty is accessed via `bribeM`.</span></span><span>
</span><span id="line-48"></span><span>    </span><span id="bribeM_"><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribeM_"><span class="hs-identifier hs-var hs-var">bribeM_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The counter for bribing.</span></span><span>
</span><span id="line-50"></span><span>    </span><span id="bribe"><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var hs-var">bribe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The payout multiplier counter, the actual multiplier is accessed via `multiplier`.</span></span><span>
</span><span id="line-52"></span><span>    </span><span id="multiplier_"><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var hs-var">multiplier_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The fraction of wealth betted.</span></span><span>
</span><span id="line-54"></span><span>    </span><span id="bet"><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#bet"><span class="hs-identifier hs-var hs-var">bet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068147"><span id="local-6989586621679068160"><span class="annot"><span class="annottext">Blackjack -&gt; Blackjack -&gt; Bool
(Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool) -&gt; Eq Blackjack
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Blackjack -&gt; Blackjack -&gt; Bool
== :: Blackjack -&gt; Blackjack -&gt; Bool
$c/= :: Blackjack -&gt; Blackjack -&gt; Bool
/= :: Blackjack -&gt; Blackjack -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068166"><span id="local-6989586621679068176"><span id="local-6989586621679068185"><span id="local-6989586621679068189"><span id="local-6989586621679068192"><span id="local-6989586621679068195"><span id="local-6989586621679068198"><span class="annot"><span class="annottext">Eq Blackjack
Eq Blackjack =&gt;
(Blackjack -&gt; Blackjack -&gt; Ordering)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Bool)
-&gt; (Blackjack -&gt; Blackjack -&gt; Blackjack)
-&gt; (Blackjack -&gt; Blackjack -&gt; Blackjack)
-&gt; Ord Blackjack
Blackjack -&gt; Blackjack -&gt; Bool
Blackjack -&gt; Blackjack -&gt; Ordering
Blackjack -&gt; Blackjack -&gt; Blackjack
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Blackjack -&gt; Blackjack -&gt; Ordering
compare :: Blackjack -&gt; Blackjack -&gt; Ordering
$c&lt; :: Blackjack -&gt; Blackjack -&gt; Bool
&lt; :: Blackjack -&gt; Blackjack -&gt; Bool
$c&lt;= :: Blackjack -&gt; Blackjack -&gt; Bool
&lt;= :: Blackjack -&gt; Blackjack -&gt; Bool
$c&gt; :: Blackjack -&gt; Blackjack -&gt; Bool
&gt; :: Blackjack -&gt; Blackjack -&gt; Bool
$c&gt;= :: Blackjack -&gt; Blackjack -&gt; Bool
&gt;= :: Blackjack -&gt; Blackjack -&gt; Bool
$cmax :: Blackjack -&gt; Blackjack -&gt; Blackjack
max :: Blackjack -&gt; Blackjack -&gt; Blackjack
$cmin :: Blackjack -&gt; Blackjack -&gt; Blackjack
min :: Blackjack -&gt; Blackjack -&gt; Blackjack
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068202"><span id="local-6989586621679068214"><span id="local-6989586621679068218"><span class="annot"><span class="annottext">Int -&gt; Blackjack -&gt; ShowS
[Blackjack] -&gt; ShowS
Blackjack -&gt; String
(Int -&gt; Blackjack -&gt; ShowS)
-&gt; (Blackjack -&gt; String)
-&gt; ([Blackjack] -&gt; ShowS)
-&gt; Show Blackjack
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Blackjack -&gt; ShowS
showsPrec :: Int -&gt; Blackjack -&gt; ShowS
$cshow :: Blackjack -&gt; String
show :: Blackjack -&gt; String
$cshowList :: [Blackjack] -&gt; ShowS
showList :: [Blackjack] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068222"><span id="local-6989586621679068224"><span class="annot"><span class="annottext">(forall x. Blackjack -&gt; Rep Blackjack x)
-&gt; (forall x. Rep Blackjack x -&gt; Blackjack) -&gt; Generic Blackjack
forall x. Rep Blackjack x -&gt; Blackjack
forall x. Blackjack -&gt; Rep Blackjack x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Blackjack -&gt; Rep Blackjack x
from :: forall x. Blackjack -&gt; Rep Blackjack x
$cto :: forall x. Rep Blackjack x -&gt; Blackjack
to :: forall x. Rep Blackjack x -&gt; Blackjack
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Blackjack.html#multiplier"><span class="hs-identifier hs-type">multiplier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-57"></span><span id="multiplier"><span class="annot"><span class="annottext">multiplier :: Blackjack -&gt; Double
</span><a href="Blackjack.html#multiplier"><span class="hs-identifier hs-var hs-var">multiplier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; (Blackjack -&gt; Double) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; (Blackjack -&gt; Double) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Blackjack -&gt; Int) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Blackjack.html#bribeM"><span class="hs-identifier hs-type">bribeM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-60"></span><span id="bribeM"><span class="annot"><span class="annottext">bribeM :: Blackjack -&gt; Double
</span><a href="Blackjack.html#bribeM"><span class="hs-identifier hs-var hs-var">bribeM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.75</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Blackjack -&gt; Int) -&gt; Blackjack -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribeM_"><span class="hs-identifier hs-var">bribeM_</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679068234"><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621679068293"><span class="annot"><span class="annottext">hash :: Blackjack -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">hash</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679068295"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068295"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679068296"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068296"><span class="hs-identifier hs-var">ya</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679068297"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068297"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679068298"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068298"><span class="hs-identifier hs-var">da</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679068299"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068299"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679068300"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068300"><span class="hs-identifier hs-var">b_</span></a></span></span><span> </span><span id="local-6989586621679068301"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068301"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068302"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068302"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679068303"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068303"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-64"></span><span>        </span><span class="hs-special">(</span><span>    </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068295"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068296"><span class="hs-identifier hs-var">ya</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span>           </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068297"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068298"><span class="hs-identifier hs-var">da</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068299"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068300"><span class="hs-identifier hs-var">b_</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">13</span></span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span>           </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068301"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">15</span></span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span>           </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068302"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">17</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`xor`</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Word64
</span><span class="hs-identifier hs-var">castDoubleToWord64</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068303"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span id="local-6989586621679068306"><span id="local-6989586621679068312"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span></span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><span class="hs-comment">{-|
The type of hands, holding cards with values summing up to `normals` with an optional additional `ace`.
(This works, because a second ace always has a value of 1).
-}</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">data</span><span> </span><span id="Hand"><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Hand"><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="normals"><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Blackjack.html#normals"><span class="hs-identifier hs-var hs-var">normals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">,</span><span> </span><span id="ace"><span class="annot"><span class="annottext">Hand -&gt; Bool
</span><a href="Blackjack.html#ace"><span class="hs-identifier hs-var hs-var">ace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068366"><span id="local-6989586621679068370"><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Bool
(Hand -&gt; Hand -&gt; Bool) -&gt; (Hand -&gt; Hand -&gt; Bool) -&gt; Eq Hand
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Hand -&gt; Hand -&gt; Bool
== :: Hand -&gt; Hand -&gt; Bool
$c/= :: Hand -&gt; Hand -&gt; Bool
/= :: Hand -&gt; Hand -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068375"><span id="local-6989586621679068379"><span id="local-6989586621679068383"><span id="local-6989586621679068386"><span id="local-6989586621679068389"><span id="local-6989586621679068392"><span id="local-6989586621679068395"><span class="annot"><span class="annottext">Eq Hand
Eq Hand =&gt;
(Hand -&gt; Hand -&gt; Ordering)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Bool)
-&gt; (Hand -&gt; Hand -&gt; Hand)
-&gt; (Hand -&gt; Hand -&gt; Hand)
-&gt; Ord Hand
Hand -&gt; Hand -&gt; Bool
Hand -&gt; Hand -&gt; Ordering
Hand -&gt; Hand -&gt; Hand
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Hand -&gt; Hand -&gt; Ordering
compare :: Hand -&gt; Hand -&gt; Ordering
$c&lt; :: Hand -&gt; Hand -&gt; Bool
&lt; :: Hand -&gt; Hand -&gt; Bool
$c&lt;= :: Hand -&gt; Hand -&gt; Bool
&lt;= :: Hand -&gt; Hand -&gt; Bool
$c&gt; :: Hand -&gt; Hand -&gt; Bool
&gt; :: Hand -&gt; Hand -&gt; Bool
$c&gt;= :: Hand -&gt; Hand -&gt; Bool
&gt;= :: Hand -&gt; Hand -&gt; Bool
$cmax :: Hand -&gt; Hand -&gt; Hand
max :: Hand -&gt; Hand -&gt; Hand
$cmin :: Hand -&gt; Hand -&gt; Hand
min :: Hand -&gt; Hand -&gt; Hand
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068398"><span id="local-6989586621679068403"><span id="local-6989586621679068406"><span class="annot"><span class="annottext">Int -&gt; Hand -&gt; ShowS
[Hand] -&gt; ShowS
Hand -&gt; String
(Int -&gt; Hand -&gt; ShowS)
-&gt; (Hand -&gt; String) -&gt; ([Hand] -&gt; ShowS) -&gt; Show Hand
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Hand -&gt; ShowS
showsPrec :: Int -&gt; Hand -&gt; ShowS
$cshow :: Hand -&gt; String
show :: Hand -&gt; String
$cshowList :: [Hand] -&gt; ShowS
showList :: [Hand] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068409"><span id="local-6989586621679068411"><span class="annot"><span class="annottext">(forall x. Hand -&gt; Rep Hand x)
-&gt; (forall x. Rep Hand x -&gt; Hand) -&gt; Generic Hand
forall x. Rep Hand x -&gt; Hand
forall x. Hand -&gt; Rep Hand x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Hand -&gt; Rep Hand x
from :: forall x. Hand -&gt; Rep Hand x
$cto :: forall x. Rep Hand x -&gt; Hand
to :: forall x. Rep Hand x -&gt; Hand
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679068416"><span id="local-6989586621679068422"><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span></span></span><span>
</span><span id="line-83"></span><span id="local-6989586621679068433"><span id="local-6989586621679068439"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span></span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679068460"><span id="local-6989586621679068464"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679068473"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068473"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679068474"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068474"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679068475"><span class="annot"><span class="annottext">&lt;&gt; :: Hand -&gt; Hand -&gt; Hand
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679068476"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068476"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span id="local-6989586621679068477"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068477"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068474"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068477"><span class="hs-identifier hs-var">w</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068473"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068476"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068473"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068476"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068474"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068477"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679068484"><span id="local-6989586621679068488"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679068491"><span class="annot"><span class="annottext">mempty :: Hand
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><span class="hs-comment">{-|
The total space of actions that can be taken in a game of blackjack.

Of these, the actions a player can take are `Bet`, `Hit`, `Stand`, and `Bribe`.
The others are internal actions to allow for better (and more readable) memoization. 
-}</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">data</span><span> </span><span id="Action"><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-var">Action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Bet"><span class="annot"><a href="Blackjack.html#Bet"><span class="hs-identifier hs-var">Bet</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Bet a fraction of your wealth</span></span><span>
</span><span id="line-100"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="Draw"><span class="annot"><a href="Blackjack.html#Draw"><span class="hs-identifier hs-var">Draw</span></a></span></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Occurs when the game is drawn</span></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="Win"><span class="annot"><a href="Blackjack.html#Win"><span class="hs-identifier hs-var">Win</span></a></span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Occurs when the game is won</span></span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="Lose"><span class="annot"><a href="Blackjack.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span></span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Occurs when the game is lost</span></span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="Dealer"><span class="annot"><a href="Blackjack.html#Dealer"><span class="hs-identifier hs-var">Dealer</span></a></span></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Occurs when the dealer has to hit</span></span><span>
</span><span id="line-104"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="Hit"><span class="annot"><a href="Blackjack.html#Hit"><span class="hs-identifier hs-var">Hit</span></a></span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Hit</span></span><span>
</span><span id="line-105"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="Stand"><span class="annot"><a href="Blackjack.html#Stand"><span class="hs-identifier hs-var">Stand</span></a></span></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Stand</span></span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="Bribe"><span class="annot"><a href="Blackjack.html#Bribe"><span class="hs-identifier hs-var">Bribe</span></a></span></span><span>        </span><span class="hs-comment">-- ^ Bribe the dealer up to 3 times, trading 25% of your remaining potential winnings,</span><span>
</span><span id="line-107"></span><span>                           </span><span class="hs-comment">-- for an additional 25% to hit a good card (see `blackjackVal`), decreasing by 25% for each hit.</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068502"><span id="local-6989586621679068505"><span class="annot"><span class="annottext">Action -&gt; Action -&gt; Bool
(Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool) -&gt; Eq Action
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Action -&gt; Action -&gt; Bool
== :: Action -&gt; Action -&gt; Bool
$c/= :: Action -&gt; Action -&gt; Bool
/= :: Action -&gt; Action -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068511"><span id="local-6989586621679068514"><span id="local-6989586621679068518"><span id="local-6989586621679068521"><span id="local-6989586621679068524"><span id="local-6989586621679068527"><span id="local-6989586621679068530"><span class="annot"><span class="annottext">Eq Action
Eq Action =&gt;
(Action -&gt; Action -&gt; Ordering)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Bool)
-&gt; (Action -&gt; Action -&gt; Action)
-&gt; (Action -&gt; Action -&gt; Action)
-&gt; Ord Action
Action -&gt; Action -&gt; Bool
Action -&gt; Action -&gt; Ordering
Action -&gt; Action -&gt; Action
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Action -&gt; Action -&gt; Ordering
compare :: Action -&gt; Action -&gt; Ordering
$c&lt; :: Action -&gt; Action -&gt; Bool
&lt; :: Action -&gt; Action -&gt; Bool
$c&lt;= :: Action -&gt; Action -&gt; Bool
&lt;= :: Action -&gt; Action -&gt; Bool
$c&gt; :: Action -&gt; Action -&gt; Bool
&gt; :: Action -&gt; Action -&gt; Bool
$c&gt;= :: Action -&gt; Action -&gt; Bool
&gt;= :: Action -&gt; Action -&gt; Bool
$cmax :: Action -&gt; Action -&gt; Action
max :: Action -&gt; Action -&gt; Action
$cmin :: Action -&gt; Action -&gt; Action
min :: Action -&gt; Action -&gt; Action
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068533"><span id="local-6989586621679068537"><span id="local-6989586621679068540"><span class="annot"><span class="annottext">Int -&gt; Action -&gt; ShowS
[Action] -&gt; ShowS
Action -&gt; String
(Int -&gt; Action -&gt; ShowS)
-&gt; (Action -&gt; String) -&gt; ([Action] -&gt; ShowS) -&gt; Show Action
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Action -&gt; ShowS
showsPrec :: Int -&gt; Action -&gt; ShowS
$cshow :: Action -&gt; String
show :: Action -&gt; String
$cshowList :: [Action] -&gt; ShowS
showList :: [Action] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068543"><span id="local-6989586621679068545"><span class="annot"><span class="annottext">(forall x. Action -&gt; Rep Action x)
-&gt; (forall x. Rep Action x -&gt; Action) -&gt; Generic Action
forall x. Rep Action x -&gt; Action
forall x. Action -&gt; Rep Action x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Action -&gt; Rep Action x
from :: forall x. Action -&gt; Rep Action x
$cto :: forall x. Rep Action x -&gt; Action
to :: forall x. Rep Action x -&gt; Action
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span id="local-6989586621679068548"><span id="local-6989586621679068554"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Serialize</span></span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span></span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="annot"><a href="Blackjack.html#unBet"><span class="hs-identifier hs-type">unBet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-113"></span><span id="unBet"><span class="annot"><span class="annottext">unBet :: Action -&gt; Double
</span><a href="Blackjack.html#unBet"><span class="hs-identifier hs-var hs-var">unBet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Bet"><span class="hs-identifier hs-type">Bet</span></a></span><span> </span><span id="local-6989586621679068634"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068634"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068634"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-114"></span><span class="annot"><a href="Blackjack.html#unBet"><span class="hs-identifier hs-var">unBet</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Double
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unBet: x != Bet y&quot;</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><a href="Blackjack.html#isBet"><span class="hs-identifier hs-type">isBet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-117"></span><span id="isBet"><span class="annot"><span class="annottext">isBet :: Action -&gt; Bool
</span><a href="Blackjack.html#isBet"><span class="hs-identifier hs-var hs-var">isBet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Bet"><span class="hs-identifier hs-type">Bet</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-118"></span><span class="annot"><a href="Blackjack.html#isBet"><span class="hs-identifier hs-var">isBet</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Blackjack.html#normalHand"><span class="hs-identifier hs-type">normalHand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span>
</span><span id="line-121"></span><span id="normalHand"><span class="annot"><span class="annottext">normalHand :: Int -&gt; Hand
</span><a href="Blackjack.html#normalHand"><span class="hs-identifier hs-var hs-var">normalHand</span></a></span></span><span> </span><span id="local-6989586621679068638"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Blackjack.html#valueHand"><span class="hs-identifier hs-type">valueHand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-124"></span><span id="valueHand"><span class="annot"><span class="annottext">valueHand :: Hand -&gt; Int
</span><a href="Blackjack.html#valueHand"><span class="hs-identifier hs-var hs-var">valueHand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679068640"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679068641"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068641"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068641"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068641"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-type">drawDistribution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span id="drawDistribution"><span class="annot"><span class="annottext">drawDistribution :: [Hand]
</span><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-var hs-var">drawDistribution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Hand -&gt; [Hand] -&gt; [Hand]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Hand
</span><a href="Blackjack.html#normalHand"><span class="hs-identifier hs-var">normalHand</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Hand) -&gt; [Int] -&gt; [Hand]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="annot"><span class="hs-comment">-- | The initial state of a game of blackjack.</span></span><span>
</span><span id="line-134"></span><span class="annot"><a href="Blackjack.html#blackjack0"><span class="hs-identifier hs-type">blackjack0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span>
</span><span id="line-135"></span><span id="blackjack0"><span class="annot"><span class="annottext">blackjack0 :: Blackjack
</span><a href="Blackjack.html#blackjack0"><span class="hs-identifier hs-var hs-var">blackjack0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Bool -&gt; Int -&gt; Int -&gt; Int -&gt; Double -&gt; Blackjack
</span><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-var">Blackjack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><span class="hs-comment">{-|
The problem statement for optimal blackjack play, geared towards objective functions for which it makes to not go all in.
(That is, long-term strategies).

Exhaustively searches whether to `Hit`, `Stand`, or `Bribe`, but uses a golden section search to find a good betting fraction.
-}</span></span><span>
</span><span id="line-143"></span><span id="local-6989586621679067805"><span id="local-6989586621679067806"><span class="annot"><a href="Blackjack.html#blackjackP"><span class="hs-identifier hs-type">blackjackP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679067805"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679067806"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#Mixture"><span class="hs-identifier hs-type">Mixture</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067806"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679067806"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="DP.html#DPProblem"><span class="hs-identifier hs-type">DPProblem</span></a></span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067806"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067805"><span class="hs-identifier hs-type">m</span></a></span></span></span><span>
</span><span id="line-144"></span><span id="blackjackP"><span class="annot"><span class="annottext">blackjackP :: forall (m :: * -&gt; *) s.
(Monad m, Fractional s, Mixture s, Ord s) =&gt;
DPProblem Blackjack s Action m
</span><a href="Blackjack.html#blackjackP"><span class="hs-identifier hs-var hs-var">blackjackP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Search Blackjack s Action m
-&gt; (Blackjack -&gt; (Blackjack -&gt; m s) -&gt; Action -&gt; m s)
-&gt; DPProblem Blackjack s Action m
forall s v a (m :: * -&gt; *).
Search s v a m
-&gt; (s -&gt; (s -&gt; m v) -&gt; a -&gt; m v) -&gt; DPProblem s v a m
</span><a href="DP.html#DPProblem"><span class="hs-identifier hs-var">DPProblem</span></a></span><span> </span><span class="annot"><span class="annottext">Search Blackjack s Action m
forall {v} {m :: * -&gt; *}.
(Ord v, Monad m, Fractional v) =&gt;
Blackjack -&gt; (Action -&gt; m v) -&gt; m (v, Maybe Action)
</span><a href="#local-6989586621679068657"><span class="hs-identifier hs-var">srch</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; (Blackjack -&gt; m s) -&gt; Action -&gt; m s
forall (m :: * -&gt; *) stat.
(Monad m, Fractional stat, Mixture stat) =&gt;
Blackjack -&gt; (Blackjack -&gt; m stat) -&gt; Action -&gt; m stat
</span><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621679068657"><span class="annot"><span class="annottext">srch :: Blackjack -&gt; (Action -&gt; m v) -&gt; m (v, Maybe Action)
</span><a href="#local-6989586621679068657"><span class="hs-identifier hs-var hs-var">srch</span></a></span></span><span> </span><span id="local-6989586621679068683"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068683"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Blackjack.html#valueHand"><span class="hs-identifier hs-var">valueHand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068683"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Double -&gt; Action)
-&gt; Double
-&gt; Double
-&gt; Blackjack
-&gt; (Action -&gt; m v)
-&gt; m (v, Maybe Action)
forall v (m :: * -&gt; *) x a s.
(Ord v, Monad m, Floating x) =&gt;
Int -&gt; (x -&gt; a) -&gt; x -&gt; x -&gt; Search s v a m
</span><a href="DP.html#uniSearch"><span class="hs-identifier hs-var">uniSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Action
</span><a href="Blackjack.html#Bet"><span class="hs-identifier hs-var">Bet</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068683"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Blackjack -&gt; Either v [Action])
-&gt; Blackjack -&gt; (Action -&gt; m v) -&gt; m (v, Maybe Action)
forall v (m :: * -&gt; *) s a.
(Ord v, Monad m) =&gt;
(s -&gt; Either v [a]) -&gt; Search s v a m
</span><a href="DP.html#enumSearch"><span class="hs-identifier hs-var">enumSearch</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Either v [Action]
forall s. Fractional s =&gt; Blackjack -&gt; Either s [Action]
</span><a href="Blackjack.html#blackjackAct"><span class="hs-identifier hs-var">blackjackAct</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068683"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-149"></span><span class="hs-comment">{-
{-|
The problem statement for optimal blackjack play, geared towards optimizing the expected value of a single round.
-}

blackjackP' :: (Monad m, Fractional s, Mixture s, Ord s) =&gt; DPProblem Blackjack s Action m
blackjackP' = DPProblem (enumSearch blackjackAct) blackjackVal
-}</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><span class="hs-comment">{-|
The set of available actions for each state.

Some notes:
Ideally, we model the case in which we never lose, but we cannot for obvious reasons.
Fortunately the game does not go on infinitely and at some point the increase in the multiplier becomes neglegible (at the scale you are expected to lose).

The next most ideal model would solve some (piecewise) linear equation to obtain an estimate for the reward in late round.
This doesn't work either, because the matrix is huge (something like n=10584) and dense.
(Which is still tractable probably, but it also needs some clever searching to get the strategy to settle on something first).

Something similar happens for draws, since this doesn't increment the multiplier, and therefore refers back to the previous state;
which would also require solving a big linear equation.

Instead, we truncate the game after round 30.
This does influence the behaviour and results in the last rounds, but this is drowned out by the small chance of getting there from earlier rounds (hopefully).

The set of actions is given as:
- if your hand is empty, bet and draw two cards for you and the dealer each
- if the value of your hand goes over 21, you lose
- if the value of the dealer's hand goes over 21, you win
- if the dealer gets a blackjack
    - and you don't, you lose
    - and you do, you draw
- if you get a blackjack, you win
- if you are standing
    - and the dealer has a better hand, you lose
    - and the dealer's hand has value less than 17, the dealer hits
    - if the your and the dealer's hand are of the same value, you draw
    - otherwise, you win
- you can hit or stand
- if you bribed less than 3 times, you can also bribe
-}</span></span><span>
</span><span id="line-191"></span><span id="local-6989586621679067831"><span class="annot"><a href="Blackjack.html#blackjackAct"><span class="hs-identifier hs-type">blackjackAct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679067831"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679067831"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-192"></span><span id="blackjackAct"><span class="annot"><span class="annottext">blackjackAct :: forall s. Fractional s =&gt; Blackjack -&gt; Either s [Action]
</span><a href="Blackjack.html#blackjackAct"><span class="hs-identifier hs-var hs-var">blackjackAct</span></a></span></span><span> </span><span id="local-6989586621679068708"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068708"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068708"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">30</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s -&gt; Either s [Action]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-number">0</span></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068710"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Action] -&gt; Either s [Action]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double -&gt; Action
</span><a href="Blackjack.html#Bet"><span class="hs-identifier hs-var">Bet</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- NOTE: leave this here so if you remove the `uniSearch`, you get back the normal expected value. </span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068710"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068711"><span class="hs-identifier hs-var">lose</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068712"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068713"><span class="hs-identifier hs-var">win</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068712"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068710"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068714"><span class="hs-identifier hs-var">draw'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068711"><span class="hs-identifier hs-var">lose</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068710"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">21</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068713"><span class="hs-identifier hs-var">win</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Bool
</span><a href="Blackjack.html#stand"><span class="hs-identifier hs-var">stand</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068708"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068710"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068712"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068711"><span class="hs-identifier hs-var">lose</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-200"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068712"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">17</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Action] -&gt; Either s [Action]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Dealer"><span class="hs-identifier hs-var">Dealer</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-201"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068710"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068712"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068714"><span class="hs-identifier hs-var">draw'</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either s [Action]
forall {a}. Either a [Action]
</span><a href="#local-6989586621679068713"><span class="hs-identifier hs-var">win</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribeM_"><span class="hs-identifier hs-var">bribeM_</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068708"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Action] -&gt; Either s [Action]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Hit"><span class="hs-identifier hs-var">Hit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Stand"><span class="hs-identifier hs-var">Stand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Bribe"><span class="hs-identifier hs-var">Bribe</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Action] -&gt; Either s [Action]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Hit"><span class="hs-identifier hs-var">Hit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Stand"><span class="hs-identifier hs-var">Stand</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621679068711"><span class="annot"><span class="annottext">lose :: Either a [Action]
</span><a href="#local-6989586621679068711"><span class="hs-identifier hs-var hs-var">lose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Action] -&gt; Either a [Action]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621679068713"><span class="annot"><span class="annottext">win :: Either a [Action]
</span><a href="#local-6989586621679068713"><span class="hs-identifier hs-var hs-var">win</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Action] -&gt; Either a [Action]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Win"><span class="hs-identifier hs-var">Win</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621679068714"><span class="annot"><span class="annottext">draw' :: Either a [Action]
</span><a href="#local-6989586621679068714"><span class="hs-identifier hs-var hs-var">draw'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Action] -&gt; Either a [Action]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Draw"><span class="hs-identifier hs-var">Draw</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621679068710"><span class="annot"><span class="annottext">y :: Int
</span><a href="#local-6989586621679068710"><span class="hs-identifier hs-var hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Blackjack.html#valueHand"><span class="hs-identifier hs-var">valueHand</span></a></span><span> </span><span class="annot"><span class="annottext">(Hand -&gt; Int) -&gt; Hand -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068708"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span id="local-6989586621679068712"><span class="annot"><span class="annottext">d :: Int
</span><a href="#local-6989586621679068712"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Blackjack.html#valueHand"><span class="hs-identifier hs-var">valueHand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#dealer"><span class="hs-identifier hs-var">dealer</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068708"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><span class="hs-comment">-- | Calculate the objective value of performing an action in the given state</span></span><span>
</span><span id="line-211"></span><span id="local-6989586621679067817"><span id="local-6989586621679067818"><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-type">blackjackVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679067817"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679067818"><span class="hs-identifier hs-type">stat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#Mixture"><span class="hs-identifier hs-type">Mixture</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067818"><span class="hs-identifier hs-type">stat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067818"><span class="hs-identifier hs-type">stat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679067817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067818"><span class="hs-identifier hs-type">stat</span></a></span></span></span><span>
</span><span id="line-212"></span><span id="blackjackVal"><span class="annot"><span class="annottext">blackjackVal :: forall (m :: * -&gt; *) stat.
(Monad m, Fractional stat, Mixture stat) =&gt;
Blackjack -&gt; (Blackjack -&gt; m stat) -&gt; Action -&gt; m stat
</span><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var hs-var">blackjackVal</span></a></span></span><span> </span><span id="local-6989586621679068764"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068764"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068765"><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068765"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Bet"><span class="hs-identifier hs-type">Bet</span></a></span><span> </span><span id="local-6989586621679068766"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068766"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679068767"><span class="annot"><span class="annottext">[[stat]]
</span><a href="#local-6989586621679068767"><span class="hs-identifier hs-var">essBet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Hand] -&gt; (Hand -&gt; m [stat]) -&gt; m [[stat]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Hand -&gt; Hand -&gt; Hand) -&gt; [Hand] -&gt; [Hand] -&gt; [Hand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Hand
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-var">drawDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-var">drawDistribution</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Hand -&gt; m [stat]) -&gt; m [[stat]])
-&gt; (Hand -&gt; m [stat]) -&gt; m [[stat]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068769"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068769"><span class="hs-identifier hs-var">drawYou</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="annottext">[Hand] -&gt; (Hand -&gt; m stat) -&gt; m [stat]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Hand -&gt; Hand -&gt; Hand) -&gt; [Hand] -&gt; [Hand] -&gt; [Hand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><span class="hs-identifier hs-var">liftA2</span></span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Hand
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-var">drawDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-var">drawDistribution</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Hand -&gt; m stat) -&gt; m [stat]) -&gt; (Hand -&gt; m stat) -&gt; m [stat]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068770"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068770"><span class="hs-identifier hs-var">drawDealer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068765"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068764"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679068769"><span class="hs-identifier hs-type">drawYou</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#dealer"><span class="hs-identifier hs-var">dealer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679068770"><span class="hs-identifier hs-type">drawDealer</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#bet"><span class="hs-identifier hs-var">bet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679068766"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068773"><span class="annot"><span class="annottext">eBet :: stat
</span><a href="#local-6989586621679068773"><span class="hs-identifier hs-var hs-var">eBet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[stat] -&gt; stat
forall a. Mixture a =&gt; [a] -&gt; a
</span><a href="Probability.html#avg"><span class="hs-identifier hs-var">avg</span></a></span><span> </span><span class="annot"><span class="annottext">([stat] -&gt; stat) -&gt; [stat] -&gt; stat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[stat]] -&gt; [stat]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[stat]]
</span><a href="#local-6989586621679068767"><span class="hs-identifier hs-var">essBet</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="annottext">stat -&gt; m stat
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068773"><span class="hs-identifier hs-var">eBet</span></a></span><span>
</span><span id="line-218"></span><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span> </span><span id="local-6989586621679068775"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068775"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068776"><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068776"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Draw"><span class="hs-identifier hs-var">Draw</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068783"><span class="annot"><span class="annottext">e :: stat
</span><a href="#local-6989586621679068783"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; stat
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#bet"><span class="hs-identifier hs-var">bet</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068775"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#bribeM"><span class="hs-identifier hs-var">bribeM</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068775"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621679068784"><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068784"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068776"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="Blackjack.html#blackjack0"><span class="hs-identifier hs-var">blackjack0</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068775"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">stat -&gt; m stat
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(stat -&gt; m stat) -&gt; stat -&gt; m stat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068783"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">stat -&gt; stat -&gt; stat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068784"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-222"></span><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span> </span><span id="local-6989586621679068785"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068785"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068786"><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068786"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Win"><span class="hs-identifier hs-var">Win</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068794"><span class="annot"><span class="annottext">e :: stat
</span><a href="#local-6989586621679068794"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; stat
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#bet"><span class="hs-identifier hs-var">bet</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068785"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#multiplier"><span class="hs-identifier hs-var">multiplier</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068785"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#bribeM"><span class="hs-identifier hs-var">bribeM</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068785"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679068795"><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068795"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068786"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="Blackjack.html#blackjack0"><span class="hs-identifier hs-var">blackjack0</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068785"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><span class="annottext">stat -&gt; m stat
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(stat -&gt; m stat) -&gt; stat -&gt; m stat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068794"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">stat -&gt; stat -&gt; stat
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068795"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-226"></span><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span> </span><span id="local-6989586621679068796"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068796"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">stat -&gt; m stat
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(stat -&gt; m stat) -&gt; stat -&gt; m stat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; stat
forall a b. (Real a, Fractional b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">realToFrac</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#bet"><span class="hs-identifier hs-var">bet</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068796"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span> </span><span id="local-6989586621679068797"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068797"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068798"><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068798"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Dealer"><span class="hs-identifier hs-var">Dealer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679068799"><span class="annot"><span class="annottext">[stat]
</span><a href="#local-6989586621679068799"><span class="hs-identifier hs-var">esHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Hand] -&gt; (Hand -&gt; m stat) -&gt; m [stat]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-var">drawDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">((Hand -&gt; m stat) -&gt; m [stat]) -&gt; (Hand -&gt; m stat) -&gt; m [stat]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068800"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068800"><span class="hs-identifier hs-var">drawDealer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068798"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068797"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#dealer"><span class="hs-identifier hs-var">dealer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Blackjack.html#dealer"><span class="hs-identifier hs-var">dealer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068797"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679068800"><span class="hs-identifier hs-type">drawDealer</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">stat -&gt; m stat
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(stat -&gt; m stat) -&gt; stat -&gt; m stat
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[stat] -&gt; stat
forall a. Mixture a =&gt; [a] -&gt; a
</span><a href="Probability.html#avg"><span class="hs-identifier hs-var">avg</span></a></span><span> </span><span class="annot"><span class="annottext">[stat]
</span><a href="#local-6989586621679068799"><span class="hs-identifier hs-var">esHit</span></a></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span> </span><span id="local-6989586621679068801"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068801"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068802"><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068802"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Hit"><span class="hs-identifier hs-var">Hit</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068807"><span class="annot"><span class="annottext">bribe' :: Int
</span><a href="#local-6989586621679068807"><span class="hs-identifier hs-var hs-var">bribe'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068801"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068814"><span class="annot"><span class="annottext">pBribe :: Double
</span><a href="#local-6989586621679068814"><span class="hs-identifier hs-var hs-var">pBribe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068801"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">4</span></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621679068816"><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068816"><span class="hs-identifier hs-var">eHitBribe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Int
</span><a href="Blackjack.html#valueHand"><span class="hs-identifier hs-var">valueHand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068801"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068802"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068801"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span class="annot"><span class="hs-number">21</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068802"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068801"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068801"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Blackjack.html#normalHand"><span class="hs-identifier hs-type">normalHand</span></a></span><span> </span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679068807"><span class="hs-identifier hs-type">bribe'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621679068817"><span class="annot"><span class="annottext">[stat]
</span><a href="#local-6989586621679068817"><span class="hs-identifier hs-var">esHit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Hand] -&gt; (Hand -&gt; m stat) -&gt; m [stat]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="Blackjack.html#drawDistribution"><span class="hs-identifier hs-var">drawDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">((Hand -&gt; m stat) -&gt; m [stat]) -&gt; (Hand -&gt; m stat) -&gt; m [stat]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068818"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068818"><span class="hs-identifier hs-var">drawYou</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068802"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068801"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068801"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679068818"><span class="hs-identifier hs-type">drawYou</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679068807"><span class="hs-identifier hs-type">bribe'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068820"><span class="annot"><span class="annottext">eHitFair :: stat
</span><a href="#local-6989586621679068820"><span class="hs-identifier hs-var hs-var">eHitFair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[stat] -&gt; stat
forall a. Mixture a =&gt; [a] -&gt; a
</span><a href="Probability.html#avg"><span class="hs-identifier hs-var">avg</span></a></span><span> </span><span class="annot"><span class="annottext">[stat]
</span><a href="#local-6989586621679068817"><span class="hs-identifier hs-var">esHit</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068824"><span class="annot"><span class="annottext">eHit :: stat
</span><a href="#local-6989586621679068824"><span class="hs-identifier hs-var hs-var">eHit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Double, stat)] -&gt; stat
forall a. Mixture a =&gt; [(Double, a)] -&gt; a
</span><a href="Probability.html#weightedAvg"><span class="hs-identifier hs-var">weightedAvg</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068814"><span class="hs-identifier hs-var">pBribe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068816"><span class="hs-identifier hs-var">eHitBribe</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679068814"><span class="hs-identifier hs-var">pBribe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068820"><span class="hs-identifier hs-var">eHitFair</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="annottext">stat -&gt; m stat
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">stat
</span><a href="#local-6989586621679068824"><span class="hs-identifier hs-var">eHit</span></a></span><span>
</span><span id="line-246"></span><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span> </span><span id="local-6989586621679068825"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068825"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068826"><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068826"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Stand"><span class="hs-identifier hs-var">Stand</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068826"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068825"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#stand"><span class="hs-identifier hs-var">stand</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span class="annot"><a href="Blackjack.html#blackjackVal"><span class="hs-identifier hs-var">blackjackVal</span></a></span><span> </span><span id="local-6989586621679068827"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068827"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679068828"><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068828"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Bribe"><span class="hs-identifier hs-var">Bribe</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">Blackjack -&gt; m stat
</span><a href="#local-6989586621679068828"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068827"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068827"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#bribeM_"><span class="hs-identifier hs-var">bribeM_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="Blackjack.html#bribeM_"><span class="hs-identifier hs-var">bribeM_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068827"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="annot"><span class="hs-comment">-- * Processing</span></span><span>
</span><span id="line-253"></span><span class="annot"><a href="Blackjack.html#fmtHand"><span class="hs-identifier hs-type">fmtHand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-254"></span><span id="fmtHand"><span class="annot"><span class="annottext">fmtHand :: Hand -&gt; String
</span><a href="Blackjack.html#fmtHand"><span class="hs-identifier hs-var hs-var">fmtHand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span> </span><span id="local-6989586621679068830"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068830"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679068831"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068831"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068830"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679068831"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Blackjack.html#fmtAdvice"><span class="hs-identifier hs-type">fmtAdvice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-257"></span><span id="fmtAdvice"><span class="annot"><span class="annottext">fmtAdvice :: (Int, Action) -&gt; String
</span><a href="Blackjack.html#fmtAdvice"><span class="hs-identifier hs-var hs-var">fmtAdvice</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068834"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068834"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068835"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679068835"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068834"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Char
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Char) -&gt; String -&gt; Char
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Action -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679068835"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span id="local-6989586621679067858"><span id="local-6989586621679067859"><span class="annot"><a href="Blackjack.html#graph"><span class="hs-identifier hs-type">graph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679067858"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067859"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679067858"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067858"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679067859"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-260"></span><span id="graph"><span class="annot"><span class="annottext">graph :: forall k a. Map k a -&gt; Map k (k, a)
</span><a href="Blackjack.html#graph"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(k -&gt; a -&gt; (k, a)) -&gt; Map k a -&gt; Map k (k, a)
forall k a b. (k -&gt; a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.mapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><a href="Blackjack.html#dumpCSV%27"><span class="hs-identifier hs-type">dumpCSV'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span id="dumpCSV%27"><span class="annot"><span class="annottext">dumpCSV' :: IO ()
</span><a href="Blackjack.html#dumpCSV%27"><span class="hs-identifier hs-var hs-var">dumpCSV'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Map (Hand, Hand, Int, Int) [(Int, Action)])
</span><a href="Blackjack.html#kellyUniCompactStored"><span class="hs-identifier hs-var">kellyUniCompactStored</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Map (Hand, Hand, Int, Int) [(Int, Action)])
-&gt; (Map (Hand, Hand, Int, Int) [(Int, Action)] -&gt; IO ()) -&gt; IO ()
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Int, Action)] -&gt; IO ()
</span><a href="Blackjack.html#dumpCSV"><span class="hs-identifier hs-var">dumpCSV</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="annot"><a href="Blackjack.html#dumpCSV"><span class="hs-identifier hs-type">dumpCSV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span id="dumpCSV"><span class="annot"><span class="annottext">dumpCSV :: Map (Hand, Hand, Int, Int) [(Int, Action)] -&gt; IO ()
</span><a href="Blackjack.html#dumpCSV"><span class="hs-identifier hs-var hs-var">dumpCSV</span></a></span></span><span> </span><span id="local-6989586621679068841"><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="#local-6989586621679068841"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679068842"><span class="annot"><span class="annottext">[(Int, Int, String)]
</span><a href="#local-6989586621679068842"><span class="hs-identifier hs-var">sheets'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [(Int, Int, String)]
</span><a href="#local-6989586621679068843"><span class="hs-identifier hs-var">sheets</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><span class="annottext">[(Int, Int, String)] -&gt; ((Int, Int, String) -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int, String)]
</span><a href="#local-6989586621679068842"><span class="hs-identifier hs-var">sheets'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Int, Int, String) -&gt; IO ()) -&gt; IO ())
-&gt; ((Int, Int, String) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068844"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068844"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068845"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068845"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068846"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679068846"><span class="hs-identifier hs-var">sheet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BS.writeFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tables_test/&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068844"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068845"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kelly.csv&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; ByteString -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679068846"><span class="hs-identifier hs-var">sheet</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="#local-6989586621679068843"><span class="hs-identifier hs-type">sheets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>    </span><span id="local-6989586621679068843"><span class="annot"><span class="annottext">sheets :: IO [(Int, Int, String)]
</span><a href="#local-6989586621679068843"><span class="hs-identifier hs-var hs-var">sheets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IO (Int, Int, String)] -&gt; IO [(Int, Int, String)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO (Int, Int, String)
forall {m :: * -&gt; *}. Monad m =&gt; Int -&gt; Int -&gt; m (Int, Int, String)
</span><a href="#local-6989586621679068849"><span class="hs-identifier hs-var">sheet</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068850"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068851"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679068851"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068851"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068850"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068850"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068851"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621679068849"><span class="annot"><span class="annottext">sheet :: Int -&gt; Int -&gt; m (Int, Int, String)
</span><a href="#local-6989586621679068849"><span class="hs-identifier hs-var hs-var">sheet</span></a></span></span><span> </span><span id="local-6989586621679068859"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068859"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679068860"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068860"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068864"><span class="annot"><span class="annottext">t1 :: Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="#local-6989586621679068864"><span class="hs-identifier hs-var hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Hand, Hand, Int, Int) -&gt; [(Int, Action)] -&gt; Bool)
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068866"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068866"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hand
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068867"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068867"><span class="hs-identifier hs-var">i'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068868"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068868"><span class="hs-identifier hs-var">j'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, Action)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068859"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068867"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068860"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068868"><span class="hs-identifier hs-var">j'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068866"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="#local-6989586621679068841"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-277"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068877"><span class="annot"><span class="annottext">t2 :: [((Hand, Hand), String)]
</span><a href="#local-6989586621679068877"><span class="hs-identifier hs-var hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Hand, Hand) String -&gt; [((Hand, Hand), String)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map (Hand, Hand) String -&gt; [((Hand, Hand), String)])
-&gt; Map (Hand, Hand) String -&gt; [((Hand, Hand), String)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Action) -&gt; String) -&gt; [(Int, Action)] -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Int, Action) -&gt; String
</span><a href="Blackjack.html#fmtAdvice"><span class="hs-identifier hs-var">fmtAdvice</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Action)] -&gt; String)
-&gt; Map (Hand, Hand) [(Int, Action)] -&gt; Map (Hand, Hand) String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((Hand, Hand, Int, Int) -&gt; (Hand, Hand))
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
-&gt; Map (Hand, Hand) [(Int, Action)]
forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">M.mapKeys</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068881"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068881"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068882"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068882"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068881"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068882"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="#local-6989586621679068864"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-278"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068889"><span class="annot"><span class="annottext">hands' :: [Hand]
</span><a href="#local-6989586621679068889"><span class="hs-identifier hs-var hs-var">hands'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068890"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679068890"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068890"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Hand] -&gt; [Hand] -&gt; [Hand]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Bool -&gt; Hand
</span><a href="Blackjack.html#Hand"><span class="hs-identifier hs-var">Hand</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068891"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679068891"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068891"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068893"><span class="annot"><span class="annottext">hands :: [String]
</span><a href="#local-6989586621679068893"><span class="hs-identifier hs-var hs-var">hands</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hand -&gt; String
</span><a href="Blackjack.html#fmtHand"><span class="hs-identifier hs-var">fmtHand</span></a></span><span> </span><span class="annot"><span class="annottext">(Hand -&gt; String) -&gt; [Hand] -&gt; [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="#local-6989586621679068889"><span class="hs-identifier hs-var">hands'</span></a></span><span>
</span><span id="line-280"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068896"><span class="annot"><span class="annottext">t3 :: [[(Hand, String)]]
</span><a href="#local-6989586621679068896"><span class="hs-identifier hs-var hs-var">t3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Hand -&gt; [(Hand, String)]) -&gt; [Hand] -&gt; [[(Hand, String)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068897"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068897"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(((Hand, Hand), String) -&gt; Maybe (Hand, String))
-&gt; [((Hand, Hand), String)] -&gt; [(Hand, String)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679068898"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068898"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068899"><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068899"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068900"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679068900"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068898"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Hand -&gt; Hand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068897"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Hand, String) -&gt; Maybe (Hand, String)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hand
</span><a href="#local-6989586621679068899"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679068900"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (Hand, String)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((Hand, Hand), String)]
</span><a href="#local-6989586621679068877"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="#local-6989586621679068889"><span class="hs-identifier hs-var">hands'</span></a></span><span>
</span><span id="line-281"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068904"><span class="annot"><span class="annottext">t4 :: [[String]]
</span><a href="#local-6989586621679068904"><span class="hs-identifier hs-var hs-var">t4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068905"><span class="annot"><span class="annottext">[(Hand, String)]
</span><a href="#local-6989586621679068905"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Hand -&gt; String) -&gt; [Hand] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; String)
-&gt; (Hand -&gt; Maybe String) -&gt; Hand -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Hand -&gt; [(Hand, String)] -&gt; Maybe String)
-&gt; [(Hand, String)] -&gt; Hand -&gt; Maybe String
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Hand -&gt; [(Hand, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">[(Hand, String)]
</span><a href="#local-6989586621679068905"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Hand]
</span><a href="#local-6989586621679068889"><span class="hs-identifier hs-var">hands'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Hand, String)] -&gt; [String]) -&gt; [[(Hand, String)]] -&gt; [[String]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[[(Hand, String)]]
</span><a href="#local-6989586621679068896"><span class="hs-identifier hs-var">t3</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068908"><span class="annot"><span class="annottext">header :: [String]
</span><a href="#local-6989586621679068908"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;You\\Deal&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679068893"><span class="hs-identifier hs-var">hands</span></a></span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068909"><span class="annot"><span class="annottext">body :: [[String]]
</span><a href="#local-6989586621679068909"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679068908"><span class="hs-identifier hs-var">header</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [[String]] -&gt; [[String]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String] -&gt; [String])
-&gt; [String] -&gt; [[String]] -&gt; [[String]]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679068893"><span class="hs-identifier hs-var">hands</span></a></span><span> </span><span class="annot"><span class="annottext">[[String]]
</span><a href="#local-6989586621679068904"><span class="hs-identifier hs-var">t4</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>            </span><span class="annot"><span class="annottext">(Int, Int, String) -&gt; m (Int, Int, String)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068859"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068860"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [[String]] -&gt; [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[[String]]
</span><a href="#local-6989586621679068909"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">{-
compactKellyEnumStored :: IO (M.Map (Hand, Hand, Int, Int) [(Int, Action)])
compactKellyEnumStored = fromRight (error &quot;bad read: compactKellyEnumStored&quot;) . decode &lt;$&gt; BS.readFile &quot;tables_test/holocure_blackjack_kelly_red.bin&quot;

kellyEnumStored :: IO (M.Map Blackjack (Double, Maybe Action))
kellyEnumStored = M.fromList . fromRight (error &quot;bad read: kellyEnumStored&quot;) . decode &lt;$&gt; BS.readFile &quot;tables_test/holocure_blackjack_kelly.bin&quot;

kellyUniStored :: IO (M.Map Blackjack (Double, Maybe Action))
kellyUniStored = M.fromList . fromRight (error &quot;bad read: kellyUniStored&quot;) . decode &lt;$&gt; BS.readFile &quot;tables_test/holocure_blackjack_kelly_uni.bin&quot;
-}</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Blackjack.html#kellyUniCompactStored"><span class="hs-identifier hs-type">kellyUniCompactStored</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span id="kellyUniCompactStored"><span class="annot"><span class="annottext">kellyUniCompactStored :: IO (Map (Hand, Hand, Int, Int) [(Int, Action)])
</span><a href="Blackjack.html#kellyUniCompactStored"><span class="hs-identifier hs-var hs-var">kellyUniCompactStored</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((Hand, Hand, Int, Int), [(Int, Action)])]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([((Hand, Hand, Int, Int), [(Int, Action)])]
 -&gt; Map (Hand, Hand, Int, Int) [(Int, Action)])
-&gt; (ByteString -&gt; [((Hand, Hand, Int, Int), [(Int, Action)])])
-&gt; ByteString
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[((Hand, Hand, Int, Int), [(Int, Action)])]
-&gt; Either String [((Hand, Hand, Int, Int), [(Int, Action)])]
-&gt; [((Hand, Hand, Int, Int), [(Int, Action)])]
forall b a. b -&gt; Either a b -&gt; b
</span><span class="hs-identifier hs-var">fromRight</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [((Hand, Hand, Int, Int), [(Int, Action)])]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bad read: kellyUniCompactStored&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either String [((Hand, Hand, Int, Int), [(Int, Action)])]
 -&gt; [((Hand, Hand, Int, Int), [(Int, Action)])])
-&gt; (ByteString
    -&gt; Either String [((Hand, Hand, Int, Int), [(Int, Action)])])
-&gt; ByteString
-&gt; [((Hand, Hand, Int, Int), [(Int, Action)])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; Either String [((Hand, Hand, Int, Int), [(Int, Action)])]
forall a. Serialize a =&gt; ByteString -&gt; Either String a
</span><span class="hs-identifier hs-var">decode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Map (Hand, Hand, Int, Int) [(Int, Action)])
-&gt; IO ByteString -&gt; IO (Map (Hand, Hand, Int, Int) [(Int, Action)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BS.readFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tables_test/holocure_blackjack_kelly_uni_compact.bin&quot;</span></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="annot"><a href="Blackjack.html#computeAndStore"><span class="hs-identifier hs-type">computeAndStore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span id="computeAndStore"><span class="annot"><span class="annottext">computeAndStore :: IO ()
</span><a href="Blackjack.html#computeAndStore"><span class="hs-identifier hs-var hs-var">computeAndStore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679068914"><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
</span><a href="#local-6989586621679068914"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO
  (HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action))
forall s.
(Ord s, Fractional s, Mixture s) =&gt;
IO (HashMap Blackjack (s, Maybe Action))
</span><a href="Blackjack.html#blackjackTableRed"><span class="hs-identifier hs-var">blackjackTableRed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Probability.html#MaxMean"><span class="hs-identifier hs-type">MaxMean</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Probability.html#Log1P"><span class="hs-identifier hs-type">Log1P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Probability.html#Mean"><span class="hs-identifier hs-type">Mean</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
-&gt; Int
forall a. HashMap Blackjack a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
</span><a href="#local-6989586621679068914"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">Maybe (MaxMean (Log1P (Mean Double)), Maybe Action) -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (MaxMean (Log1P (Mean Double)), Maybe Action) -&gt; IO ())
-&gt; Maybe (MaxMean (Log1P (Mean Double)), Maybe Action) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
</span><a href="#local-6989586621679068914"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
-&gt; Blackjack -&gt; Maybe (MaxMean (Log1P (Mean Double)), Maybe Action)
forall k v. (Eq k, Hashable k) =&gt; HashMap k v -&gt; k -&gt; Maybe v
</span><span class="hs-operator hs-var">HM.!?</span></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="Blackjack.html#blackjack0"><span class="hs-identifier hs-var">blackjack0</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068923"><span class="annot"><span class="annottext">compTable :: Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="#local-6989586621679068923"><span class="hs-identifier hs-var hs-var">compTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map
  (Hand, Hand, Int, Int)
  [(Blackjack, (MaxMean (Log1P (Mean Double)), Action))]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall v.
HasMean v Double =&gt;
Map (Hand, Hand, Int, Int) [(Blackjack, (v, Action))]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="Blackjack.html#compact"><span class="hs-identifier hs-var">compact</span></a></span><span> </span><span class="annot"><span class="annottext">(Map
   (Hand, Hand, Int, Int)
   [(Blackjack, (MaxMean (Log1P (Mean Double)), Action))]
 -&gt; Map (Hand, Hand, Int, Int) [(Int, Action)])
-&gt; Map
     (Hand, Hand, Int, Int)
     [(Blackjack, (MaxMean (Log1P (Mean Double)), Action))]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
-&gt; Map
     (Hand, Hand, Int, Int)
     [(Blackjack, (MaxMean (Log1P (Mean Double)), Action))]
forall s.
Map Blackjack (s, Maybe Action)
-&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (s, Action))]
</span><a href="Blackjack.html#summary"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
 -&gt; Map
      (Hand, Hand, Int, Int)
      [(Blackjack, (MaxMean (Log1P (Mean Double)), Action))])
-&gt; Map Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
-&gt; Map
     (Hand, Hand, Int, Int)
     [(Blackjack, (MaxMean (Log1P (Mean Double)), Action))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Blackjack, (MaxMean (Log1P (Mean Double)), Maybe Action))]
-&gt; Map Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Blackjack, (MaxMean (Log1P (Mean Double)), Maybe Action))]
 -&gt; Map Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action))
-&gt; [(Blackjack, (MaxMean (Log1P (Mean Double)), Maybe Action))]
-&gt; Map Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
-&gt; [(Blackjack, (MaxMean (Log1P (Mean Double)), Maybe Action))]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
</span><a href="#local-6989586621679068914"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BS.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tables_test/holocure_blackjack_kelly_uni_compact.bin&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; ByteString -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[((Hand, Hand, Int, Int), [(Int, Action)])] -&gt; ByteString
forall a. Serialize a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">([((Hand, Hand, Int, Int), [(Int, Action)])] -&gt; ByteString)
-&gt; [((Hand, Hand, Int, Int), [(Int, Action)])] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Int, Action)]
-&gt; [((Hand, Hand, Int, Int), [(Int, Action)])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="#local-6989586621679068923"><span class="hs-identifier hs-var">compTable</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">BS.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tables_test/holocure_blackjack_kelly_uni.bin&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; ByteString -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Blackjack, (Double, Maybe Action))] -&gt; ByteString
forall a. Serialize a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">([(Blackjack, (Double, Maybe Action))] -&gt; ByteString)
-&gt; [(Blackjack, (Double, Maybe Action))] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (Double, Maybe Action)
-&gt; [(Blackjack, (Double, Maybe Action))]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">(HashMap Blackjack (Double, Maybe Action)
 -&gt; [(Blackjack, (Double, Maybe Action))])
-&gt; HashMap Blackjack (Double, Maybe Action)
-&gt; [(Blackjack, (Double, Maybe Action))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MaxMean (Log1P (Mean Double)) -&gt; Double)
-&gt; (MaxMean (Log1P (Mean Double)), Maybe Action)
-&gt; (Double, Maybe Action)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">MaxMean (Log1P (Mean Double)) -&gt; Double
forall a r. HasMean a r =&gt; a -&gt; r
</span><a href="Probability.html#mean"><span class="hs-identifier hs-var">mean</span></a></span><span> </span><span class="annot"><span class="annottext">((MaxMean (Log1P (Mean Double)), Maybe Action)
 -&gt; (Double, Maybe Action))
-&gt; HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
-&gt; HashMap Blackjack (Double, Maybe Action)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap Blackjack (MaxMean (Log1P (Mean Double)), Maybe Action)
</span><a href="#local-6989586621679068914"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span id="local-6989586621679067914"><span class="annot"><a href="Blackjack.html#compact"><span class="hs-identifier hs-type">compact</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Probability.html#HasMean"><span class="hs-identifier hs-type">HasMean</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067914"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067914"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-313"></span><span id="compact"><span class="annot"><span class="annottext">compact :: forall v.
HasMean v Double =&gt;
Map (Hand, Hand, Int, Int) [(Blackjack, (v, Action))]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
</span><a href="Blackjack.html#compact"><span class="hs-identifier hs-var hs-var">compact</span></a></span></span><span> </span><span id="local-6989586621679068944"><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Blackjack, (v, Action))]
</span><a href="#local-6989586621679068944"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Int, Action)] -&gt; Bool)
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([(Int, Action)] -&gt; Bool) -&gt; [(Int, Action)] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Action)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map (Hand, Hand, Int, Int) [(Int, Action)]
 -&gt; Map (Hand, Hand, Int, Int) [(Int, Action)])
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([(Blackjack, (v, Action))] -&gt; [(Int, Action)])
-&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (v, Action))]
-&gt; Map (Hand, Hand, Int, Int) [(Int, Action)]
forall a b.
(a -&gt; b)
-&gt; Map (Hand, Hand, Int, Int) a -&gt; Map (Hand, Hand, Int, Int) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Blackjack, (Double, Action))] -&gt; [(Int, Action)]
</span><a href="#local-6989586621679068948"><span class="hs-identifier hs-var">groupRuns</span></a></span><span> </span><span class="annot"><span class="annottext">([(Blackjack, (Double, Action))] -&gt; [(Int, Action)])
-&gt; ([(Blackjack, (v, Action))] -&gt; [(Blackjack, (Double, Action))])
-&gt; [(Blackjack, (v, Action))]
-&gt; [(Int, Action)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Blackjack, (v, Action)) -&gt; (Blackjack, (Double, Action)))
-&gt; [(Blackjack, (v, Action))] -&gt; [(Blackjack, (Double, Action))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((v, Action) -&gt; (Double, Action))
-&gt; (Blackjack, (v, Action)) -&gt; (Blackjack, (Double, Action))
forall b c a. (b -&gt; c) -&gt; (a, b) -&gt; (a, c)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(v -&gt; Double) -&gt; (v, Action) -&gt; (Double, Action)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; Double
forall a r. HasMean a r =&gt; a -&gt; r
</span><a href="Probability.html#mean"><span class="hs-identifier hs-var">mean</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Hand, Hand, Int, Int) [(Blackjack, (v, Action))]
</span><a href="#local-6989586621679068944"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-315"></span><span>    </span><span class="annot"><a href="#local-6989586621679068948"><span class="hs-identifier hs-type">groupRuns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621679068948"><span class="annot"><span class="annottext">groupRuns :: [(Blackjack, (Double, Action))] -&gt; [(Int, Action)]
</span><a href="#local-6989586621679068948"><span class="hs-identifier hs-var hs-var">groupRuns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Int, (Double, Action))] -&gt; (Int, Action))
-&gt; [[(Int, (Double, Action))]] -&gt; [(Int, Action)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[(Int, (Double, Action))] -&gt; (Int, Action)
</span><a href="#local-6989586621679068949"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">([[(Int, (Double, Action))]] -&gt; [(Int, Action)])
-&gt; ([(Blackjack, (Double, Action))] -&gt; [[(Int, (Double, Action))]])
-&gt; [(Blackjack, (Double, Action))]
-&gt; [(Int, Action)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Int, (Double, Action)) -&gt; (Int, (Double, Action)) -&gt; Bool)
-&gt; [(Int, (Double, Action))] -&gt; [[(Int, (Double, Action))]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">groupBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action -&gt; Action -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(Action -&gt; Action -&gt; Bool)
-&gt; ((Int, (Double, Action)) -&gt; Action)
-&gt; (Int, (Double, Action))
-&gt; (Int, (Double, Action))
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><span class="hs-operator hs-var">`on`</span></span><span> </span><span class="annot"><span class="annottext">(Double, Action) -&gt; Action
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Double, Action) -&gt; Action)
-&gt; ((Int, (Double, Action)) -&gt; (Double, Action))
-&gt; (Int, (Double, Action))
-&gt; Action
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int, (Double, Action)) -&gt; (Double, Action)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, (Double, Action))] -&gt; [[(Int, (Double, Action))]])
-&gt; ([(Blackjack, (Double, Action))] -&gt; [(Int, (Double, Action))])
-&gt; [(Blackjack, (Double, Action))]
-&gt; [[(Int, (Double, Action))]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Int, (Double, Action)) -&gt; Int)
-&gt; [(Int, (Double, Action))] -&gt; [(Int, (Double, Action))]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">(Int, (Double, Action)) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(Int, (Double, Action))] -&gt; [(Int, (Double, Action))])
-&gt; ([(Blackjack, (Double, Action))] -&gt; [(Int, (Double, Action))])
-&gt; [(Blackjack, (Double, Action))]
-&gt; [(Int, (Double, Action))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Blackjack, (Double, Action)) -&gt; (Int, (Double, Action)))
-&gt; [(Blackjack, (Double, Action))] -&gt; [(Int, (Double, Action))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Blackjack -&gt; Int)
-&gt; (Blackjack, (Double, Action)) -&gt; (Int, (Double, Action))
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><a href="#local-6989586621679068949"><span class="hs-identifier hs-type">pick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621679068949"><span class="annot"><span class="annottext">pick :: [(Int, (Double, Action))] -&gt; (Int, Action)
</span><a href="#local-6989586621679068949"><span class="hs-identifier hs-var hs-var">pick</span></a></span></span><span> </span><span id="local-6989586621679068952"><span class="annot"><span class="annottext">xs :: [(Int, (Double, Action))]
</span><a href="#local-6989586621679068952"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679068953"><span class="annot"><span class="annottext">(Int, (Double, Action))
</span><a href="#local-6989586621679068953"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(Int, (Double, Action))]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">minimum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, (Double, Action)) -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Int, (Double, Action)) -&gt; Int)
-&gt; [(Int, (Double, Action))] -&gt; [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Int, (Double, Action))]
</span><a href="#local-6989586621679068952"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Action) -&gt; Action
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Double, Action) -&gt; Action) -&gt; (Double, Action) -&gt; Action
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int, (Double, Action)) -&gt; (Double, Action)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Int, (Double, Action))
</span><a href="#local-6989586621679068953"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="#local-6989586621679068949"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Int, Action)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;crude:pick: This is bad.&quot;</span></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span id="local-6989586621679067915"><span class="annot"><a href="Blackjack.html#summary"><span class="hs-identifier hs-type">summary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067915"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Hand"><span class="hs-identifier hs-type">Hand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067915"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-323"></span><span id="summary"><span class="annot"><span class="annottext">summary :: forall s.
Map Blackjack (s, Maybe Action)
-&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (s, Action))]
</span><a href="Blackjack.html#summary"><span class="hs-identifier hs-var hs-var">summary</span></a></span></span><span> </span><span id="local-6989586621679068957"><span class="annot"><span class="annottext">Map Blackjack (s, Maybe Action)
</span><a href="#local-6989586621679068957"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Blackjack, (s, Action))]
 -&gt; [(Blackjack, (s, Action))] -&gt; [(Blackjack, (s, Action))])
-&gt; (Blackjack -&gt; (Hand, Hand, Int, Int))
-&gt; Map Blackjack [(Blackjack, (s, Action))]
-&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (s, Action))]
forall k2 a k1.
Ord k2 =&gt;
(a -&gt; a -&gt; a) -&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">M.mapKeysWith</span></span><span> </span><span class="annot"><span class="annottext">[(Blackjack, (s, Action))]
-&gt; [(Blackjack, (s, Action))] -&gt; [(Blackjack, (s, Action))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068959"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068959"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#you"><span class="hs-identifier hs-var">you</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068959"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Hand
</span><a href="Blackjack.html#dealer"><span class="hs-identifier hs-var">dealer</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068959"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribe"><span class="hs-identifier hs-var">bribe</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068959"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#bribeM_"><span class="hs-identifier hs-var">bribeM_</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068959"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map Blackjack [(Blackjack, (s, Action))]
 -&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (s, Action))])
-&gt; (Map Blackjack (s, Maybe Action)
    -&gt; Map Blackjack [(Blackjack, (s, Action))])
-&gt; Map Blackjack (s, Maybe Action)
-&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (s, Action))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Blackjack, (s, Maybe Action)) -&gt; [(Blackjack, (s, Action))])
-&gt; Map Blackjack (Blackjack, (s, Maybe Action))
-&gt; Map Blackjack [(Blackjack, (s, Action))]
forall a b. (a -&gt; b) -&gt; Map Blackjack a -&gt; Map Blackjack b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Blackjack, (s, Maybe Action)) -&gt; [(Blackjack, (s, Action))]
forall s.
(Blackjack, (s, Maybe Action)) -&gt; [(Blackjack, (s, Action))]
</span><a href="#local-6989586621679068960"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Blackjack (Blackjack, (s, Maybe Action))
 -&gt; Map Blackjack [(Blackjack, (s, Action))])
-&gt; (Map Blackjack (s, Maybe Action)
    -&gt; Map Blackjack (Blackjack, (s, Maybe Action)))
-&gt; Map Blackjack (s, Maybe Action)
-&gt; Map Blackjack [(Blackjack, (s, Action))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Blackjack (s, Maybe Action)
-&gt; Map Blackjack (Blackjack, (s, Maybe Action))
forall k a. Map k a -&gt; Map k (k, a)
</span><a href="Blackjack.html#graph"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Blackjack (s, Maybe Action)
 -&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (s, Action))])
-&gt; Map Blackjack (s, Maybe Action)
-&gt; Map (Hand, Hand, Int, Int) [(Blackjack, (s, Action))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Blackjack (s, Maybe Action)
</span><a href="#local-6989586621679068957"><span class="hs-identifier hs-var">table</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621679068968"><span class="annot"><span class="annottext">v :: [(Int, Double)]
</span><a href="#local-6989586621679068968"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679068969"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068969"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068969"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; (Int, Double)) -&gt; Double -&gt; (Int, Double)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Action -&gt; Double
</span><a href="Blackjack.html#unBet"><span class="hs-identifier hs-var">unBet</span></a></span><span> </span><span class="annot"><span class="annottext">(Action -&gt; Double) -&gt; Action -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe Action -&gt; Action
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Action -&gt; Action) -&gt; Maybe Action -&gt; Action
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(s, Maybe Action) -&gt; Maybe Action
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((s, Maybe Action) -&gt; Maybe Action)
-&gt; (s, Maybe Action) -&gt; Maybe Action
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Blackjack (s, Maybe Action)
</span><a href="#local-6989586621679068957"><span class="hs-identifier hs-var">table</span></a></span><span> </span><span class="annot"><span class="annottext">Map Blackjack (s, Maybe Action) -&gt; Blackjack -&gt; (s, Maybe Action)
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="Blackjack.html#blackjack0"><span class="hs-identifier hs-var">blackjack0</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679068969"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Int, Double)) -&gt; [Int] -&gt; [(Int, Double)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">19</span></span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679067947"><span class="annot"><a href="#local-6989586621679068960"><span class="hs-identifier hs-type">check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067947"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067947"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621679068960"><span class="annot"><span class="annottext">check :: forall s.
(Blackjack, (s, Maybe Action)) -&gt; [(Blackjack, (s, Action))]
</span><a href="#local-6989586621679068960"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Action
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="#local-6989586621679068960"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068979"><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068979"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068980"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679068980"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679068981"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679068981"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068979"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679068980"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679068981"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068979"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679068981"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Action -&gt; [Action] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Hit"><span class="hs-identifier hs-var">Hit</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Stand"><span class="hs-identifier hs-var">Stand</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Action
</span><a href="Blackjack.html#Bribe"><span class="hs-identifier hs-var">Bribe</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Int, Double)] -&gt; Maybe Double
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Int
</span><a href="Blackjack.html#multiplier_"><span class="hs-identifier hs-var">multiplier_</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068979"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Int, Double)]
</span><a href="#local-6989586621679068968"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Double -&gt; Maybe Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Maybe Double
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Blackjack -&gt; Double
</span><a href="Blackjack.html#bet"><span class="hs-identifier hs-var">bet</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="#local-6989586621679068979"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Action -&gt; Bool
</span><a href="Blackjack.html#isBet"><span class="hs-identifier hs-var">isBet</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621679068981"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span id="local-6989586621679067908"><span class="annot"><a href="Blackjack.html#blackjackTableRed"><span class="hs-identifier hs-type">blackjackTableRed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679067908"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679067908"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Probability.html#Mixture"><span class="hs-identifier hs-type">Mixture</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679067908"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><a href="Blackjack.html#Blackjack"><span class="hs-identifier hs-type">Blackjack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679067908"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Blackjack.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-333"></span><span id="blackjackTableRed"><span class="annot"><span class="annottext">blackjackTableRed :: forall s.
(Ord s, Fractional s, Mixture s) =&gt;
IO (HashMap Blackjack (s, Maybe Action))
</span><a href="Blackjack.html#blackjackTableRed"><span class="hs-identifier hs-var hs-var">blackjackTableRed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DPProblem Blackjack s Action IO
-&gt; Blackjack -&gt; IO (HashMap Blackjack (s, Maybe Action))
forall s v a.
(Hashable s, Ord v) =&gt;
DPProblem s v a IO -&gt; s -&gt; IO (HashMap s (v, Maybe a))
</span><a href="DP.html#reducedDP"><span class="hs-identifier hs-var">reducedDP</span></a></span><span> </span><span class="annot"><span class="annottext">DPProblem Blackjack s Action IO
forall (m :: * -&gt; *) s.
(Monad m, Fractional s, Mixture s, Ord s) =&gt;
DPProblem Blackjack s Action m
</span><a href="Blackjack.html#blackjackP"><span class="hs-identifier hs-var">blackjackP</span></a></span><span> </span><span class="annot"><span class="annottext">Blackjack
</span><a href="Blackjack.html#blackjack0"><span class="hs-identifier hs-var">blackjack0</span></a></span></pre></body></html>